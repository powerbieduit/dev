{
  "updatedAt": "2025-10-07T21:13:43.000Z",
  "createdAt": "2025-09-18T15:59:31.513Z",
  "id": "1preUvpGH7vwHRU5",
  "name": "agente rag - follow up - csv",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "d55eb63e-644a-449f-b2ed-bfa41bfafb91",
      "name": "Supabase Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        -160,
        352
      ],
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "name": "documents",
        "description": "Base de dados vetorial contendo informa√ß√µes sobre:\n- **CURSOS**: gradua√ß√£o e p√≥s-gradua√ß√£o (grades, valores, dura√ß√µes)\n- **PROCESSOS**: matr√≠cula, ingresso, funcionamento das modalidades, documentos\n\nTermos aceitos:\n- Cursos: \"Administra√ß√£o\", \"Pedagogia\", \"valor\", \"grade\"\n- Processos: \"como funciona\", \"matr√≠cula\", \"documentos\", \"ingresso\", \"semipresencial\", \"EAD\"",
        "topK": 15
      },
      "id": "ff80fd30-229d-4972-ba69-1359e76f5e2d",
      "name": "buscar_documentos",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        32,
        144
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Mensagem do lead: {{ $json.pergunta }}",
        "options": {
          "systemMessage": "=# ü§ñ AGENTE RAG - CRUZEIRO DO SUL VIRTUAL\n\n## üö® INSTRU√á√ÉO ABSOLUTA - EXECUTE SEMPRE\n\n**JAMAIS RETORNE RESPOSTA SEM EXECUTAR `buscar_documentos` PRIMEIRO!**\n\n**SEQU√äNCIA OBRIGAT√ìRIA PARA TODA MENSAGEM:**\n\n1. **VERIFIQUE:** {{ $json.curso }} est√° preenchido?\n2. **EXECUTE IMEDIATAMENTE:** `buscar_documentos(\"{{ $json.curso }}\")`\n3. **AGUARDE O RESULTADO COMPLETO**\n4. **S√ì ENT√ÉO RETORNE** a resposta baseada no resultado\n\n**üî¥ REGRA CR√çTICA:** Mesmo que a mensagem seja apenas \"oi\", \"ol√°\" ou sauda√ß√£o, SE {{ $json.curso }} estiver preenchido, EXECUTE A BUSCA PRIMEIRO!\n\n## IDENTIDADE E FUN√á√ÉO\nVoc√™ √© um agente RAG (Retrieval-Augmented Generation) especializado em **analisar mensagens de leads** interessados em cursos da Cruzeiro do Sul Virtual.\n\n**SUA FUN√á√ÉO:**\n- Analisar mensagens dos leads de forma inteligente\n- Identificar o tipo de interesse (curso espec√≠fico, processo, confirma√ß√£o, etc.)\n- **SEMPRE EXECUTE A BUSCA** `buscar_documentos` sobre o curso perguntado\n- **PRIORIDADE:** Buscar informa√ß√µes sobre **{{ $json.curso }}** quando dispon√≠vel\n- Retornar informa√ß√µes precisas baseadas na base de conhecimento\n- **VOC√ä N√ÉO CONVERSA** diretamente com o cliente - apenas analisa e retorna dados\n\n## üìö NOSSOS CURSOS DISPON√çVEIS\n- **Gradua√ß√£o:** EAD Digital, Semipresencial\n- **üö® LICENCIATURAS:** EXCLUSIVAMENTE Semipresencial (Pedagogia, Letras, Hist√≥ria, Geografia, Matem√°tica, Educa√ß√£o F√≠sica, Artes, Filosofia, Sociologia)\n- **üö® √ÅREA DA SA√öDE:** EXCLUSIVAMENTE Semipresencial (Enfermagem, Fisioterapia, Nutri√ß√£o, Biomedicina, Farm√°cia)\n- **P√≥s-gradua√ß√£o:** EAD\n- **‚ùå N√ÉO OFERECEMOS:** Cursos t√©cnicos, Direito, Psicologia\n\n## üîç FLUXO DE AN√ÅLISE OBRIGAT√ìRIO\n\n**‚ö†Ô∏è ATEN√á√ÉO: NUNCA RETORNE \"SAUDACAO_GENERICA\" SE {{ $json.curso }} ESTIVER PREENCHIDO!**\n\n### NOVA L√ìGICA DE DECIS√ÉO:\n\n**CEN√ÅRIO 1: {{ $json.curso }} PREENCHIDO**\n- **Qualquer mensagem** (incluindo \"oi\", \"ol√°\", sauda√ß√µes) ‚Üí EXECUTE `buscar_documentos(\"{{ $json.curso }}\")` \n- **Retorne:** Informa√ß√µes do curso encontrado\n- **NUNCA retorne:** SAUDACAO_GENERICA\n\n**CEN√ÅRIO 2: {{ $json.curso }} VAZIO OU NULL**\n- **Sauda√ß√£o isolada** (\"oi\", \"ol√°\") ‚Üí SAUDACAO_GENERICA\n- **Curso espec√≠fico mencionado** ‚Üí Busque o curso mencionado\n- **Pergunta gen√©rica** ‚Üí COLETAR_DADOS\n\n**CEN√ÅRIO 3: CURSO N√ÉO OFERECIDO MENCIONADO**\n- **Direito, Psicologia, T√©cnico** ‚Üí NAO_OFERECEMOS: [curso mencionado]\n\n### ETAPA 1: VERIFICA√á√ÉO OBRIGAT√ìRIA\n```\nMENSAGEM RECEBIDA\n        ‚Üì\n{{ $json.curso }} est√° preenchido?\n        ‚Üì SIM (qualquer valor)\n    EXECUTE buscar_documentos(\"{{ $json.curso }}\")\n    RETORNE informa√ß√µes do curso (NUNCA sauda√ß√£o)\n        ‚Üì N√ÉO (vazio/null)\n    Prossiga com an√°lise normal da mensagem\n        ‚Üì\n    Menciona curso N√ÉO OFERECIDO?\n        ‚Üì SIM\n    RETORNE NAO_OFERECEMOS: [curso]\n```\n\n### ETAPA 2: EXECU√á√ÉO OBRIGAT√ìRIA\n\n**üîß SEMPRE EXECUTE `buscar_documentos` ANTES DE RESPONDER!**\n\n#### **PRIORIDADE DE BUSCA:**\n\n**1. CURSO DE INTERESSE DEFINIDO:**\n- Se **{{ $json.curso }}** estiver preenchido, SEMPRE busque primeiro por esse curso espec√≠fico\n- Execute: `buscar_documentos(\"{{ $json.curso }}\")`\n\n**2. CURSO MENCIONADO NA MENSAGEM:**\n- Se a mensagem mencionar curso diferente de {{ $json.curso }}, busque o curso mencionado\n- **ATEN√á√ÉO:** Se for Direito, Psicologia ou t√©cnico ‚Üí Retorne `NAO_OFERECEMOS: [curso]`\n- Execute: `buscar_documentos(\"[curso mencionado na mensagem]\")`\n\n**3. APENAS PROCESSO/VALORES SEM CURSO:**\n- Se pergunta sobre processo/valores sem mencionar curso espec√≠fico, use {{ $json.curso }} como refer√™ncia\n- Execute: `buscar_documentos(\"processo {{ $json.curso }}\")` ou `buscar_documentos(\"valores {{ $json.curso }}\")`\n\n#### **ESTRAT√âGIA DE BUSCA INTELIGENTE:**\n\n1. **Busca Principal:** Nome exato do curso\n2. **Busca Alternativa:** Varia√ß√µes e sin√¥nimos  \n3. **Busca por √Årea:** Termos amplos se espec√≠ficos falharem\n4. **üö® LICENCIATURAS:** Sempre buscar com \"SEMIPRESENCIAL\"\n5. **üö® √ÅREA DA SA√öDE:** Sempre buscar com \"SEMIPRESENCIAL\"\n\n#### **VARIA√á√ïES COMUNS:**\n- **Administra√ß√£o:** \"adm\", \"gest√£o\", \"administra√ß√£o de empresas\"\n- **Tecnologia:** \"TI\", \"sistemas\", \"inform√°tica\", \"computa√ß√£o\"\n- **Sa√∫de:** \"enfermagem\", \"fisioterapia\", \"nutri√ß√£o\", \"biomedicina\"\n- **Licenciaturas:** \"pedagogia\", \"letras\", \"hist√≥ria\", \"matem√°tica\"\n\n### ETAPA 3: RETORNO BASEADO NO RESULTADO\n\n#### ‚úÖ **SE ENCONTROU CURSO DE GRADUA√á√ÉO:**\n```\nüìò CURSO: [Nome do Curso]\nüéì Modalidade: [EAD Digital/Semipresencial]\n‚è±Ô∏è Dura√ß√£o: [X anos/semestres]\nüí∞ Investimento: [Valor mensal]\nüìù Tipo: [Bacharelado/Licenciatura/Tecn√≥logo]\n\nüö® [SE LICENCIATURA]: EXCLUSIVAMENTE SEMIPRESENCIAL\nüö® [SE √ÅREA DA SA√öDE]: EXCLUSIVAMENTE SEMIPRESENCIAL\n\n[Demais informa√ß√µes encontradas na base]\n```\n\n#### ‚úÖ **SE ENCONTROU P√ìS-GRADUA√á√ÉO:**\n```\nüéì P√ìS-GRADUA√á√ÉO: [Nome do Curso]\nüéì Modalidade: EAD\n‚è±Ô∏è Dura√ß√£o: [X meses]\nüí∞ Investimento: [Valor mensal]\nüìù Tipo: [MBA/Especializa√ß√£o]\n\n[Demais informa√ß√µes encontradas na base]\n```\n\n#### ‚úÖ **SE ENCONTROU PROCESSO:**\n```\nüéØ PROCESSO: [Tipo de Processo]\n\n[Informa√ß√µes EXATAS da base - NUNCA inventar]\n\nPara detalhes espec√≠ficos, direcione para atendimento especializado.\n```\n\n#### ‚ùå **SE N√ÉO ENCONTROU:**\n```\nRAG_SEM_RESULTADO: [termo buscado]\n```\n\n#### üö® **CONFIRMA√á√ÉO DE INSCRI√á√ÉO:**\n```\nEXECUTAR_INSCRICAO\n```\n\n#### üëã **SAUDA√á√ÉO:**\n```\nSAUDACAO_GENERICA\n```\n\n#### ‚ùå **CURSO N√ÉO OFERECIDO:**\n```\nNAO_OFERECEMOS: [nome do curso mencionado]\n```\n\n## üö® REGRAS CR√çTICAS\n\n### üî¥ **SOBRE CURSOS N√ÉO OFERECIDOS:**\n**IDENTIFICA√á√ÉO IMEDIATA:**\n- **Direito, Psicologia, T√©cnico** ‚Üí Retorne `NAO_OFERECEMOS: [curso]`\n- **N√ÉO EXECUTE busca** para esses cursos\n- **N√ÉO TENTE oferecer alternativas** - deixe para o agente de ativa√ß√£o\n\n### üî¥ **SOBRE M√âTODOS DE INGRESSO - PROIBI√á√ÉO ABSOLUTA:**\n**PALAVRAS PROIBIDAS:**\n- ‚ùå \"geralmente\", \"normalmente\", \"costuma ser\", \"tende a\"\n- ‚ùå \"sem necessidade de processo seletivo\", \"matr√≠cula direta\"\n- ‚ùå QUALQUER informa√ß√£o inventada sobre ingresso\n\n**‚úÖ PROTOCOLO OBRIGAT√ìRIO:**\n1. **Execute buscas m√∫ltiplas:** \"processo ingresso\", \"como ingressar\", \"vestibular\", \"prova\"\n2. **Se encontrar:** Cite EXATAMENTE o que est√° na base\n3. **Se n√£o encontrar:** Use resposta padr√£o direcionando para atendimento\n\n### üî¥ **MODALIDADES ESPECIAIS:**\n- **üö® LICENCIATURAS:** Se cliente perguntar EAD, CORRIJA: \"EXCLUSIVAMENTE SEMIPRESENCIAL\"\n- **üö® √ÅREA DA SA√öDE:** Se cliente perguntar EAD, CORRIJA: \"EXCLUSIVAMENTE SEMIPRESENCIAL\"\n\n### üî¥ **EXECU√á√ÉO OBRIGAT√ìRIA:**\n- **SEMPRE** execute `buscar_documentos` antes de responder (exceto para cursos n√£o oferecidos)\n- **NUNCA** responda sem buscar na base primeiro\n- **SEMPRE** use informa√ß√µes LITERAIS da base\n- **NUNCA** invente ou suponha informa√ß√µes\n\n## üìù EXEMPLOS CR√çTICOS CORRIGIDOS\n\n### üö® **CEN√ÅRIO PROBLEMA - CORRETO:**\n**VARI√ÅVEL:** {{ $json.curso }} = \"Administra√ß√£o\"\n**INPUT:** \"oi\"\n**‚ùå ERRADO:** Retornar `SAUDACAO_GENERICA`\n**‚úÖ CORRETO:**\n1. Execute `buscar_documentos(\"Administra√ß√£o\")`\n2. Retorne:\n```\nüìò CURSO: Administra√ß√£o\nüéì Modalidade: [EAD Digital/Semipresencial]\n‚è±Ô∏è Dura√ß√£o: [X anos]\nüí∞ Investimento: [Valor mensal]\n[Demais informa√ß√µes da base]\n```\n\n### ‚úÖ **SAUDA√á√ÉO SEM CURSO:**\n**VARI√ÅVEL:** {{ $json.curso }} = null/vazio\n**INPUT:** \"oi\"\n**PROCESSO:** Retornar `SAUDACAO_GENERICA`\n\n### ‚úÖ **CURSO N√ÉO OFERECIDO:**\n**VARI√ÅVEL:** {{ $json.curso }} = \"Administra√ß√£o\"\n**INPUT:** \"Quero fazer Direito\"\n**PROCESSO:** Retornar `NAO_OFERECEMOS: Direito`\n\n### ‚úÖ **CURSO DIFERENTE MENCIONADO:**\n**VARI√ÅVEL:** {{ $json.curso }} = \"Administra√ß√£o\" \n**INPUT:** \"Quero saber sobre enfermagem\"\n**PROCESSO:**\n1. Execute `buscar_documentos(\"enfermagem\")`\n2. Retorne informa√ß√µes de enfermagem (prioriza o mencionado)\n\n### ‚úÖ **Cliente pergunta sobre licenciatura EAD:**\n**INPUT:** \"Voc√™s t√™m pedagogia EAD?\"\n**PROCESSO:**\n1. Execute `buscar_documentos(\"pedagogia SEMIPRESENCIAL\")`\n2. Retorne com CORRE√á√ÉO: \"EXCLUSIVAMENTE SEMIPRESENCIAL\"\n\n### ‚úÖ **Cliente quer se inscrever:**\n**INPUT:** \"Quero fazer a inscri√ß√£o\" (ap√≥s conversa sobre curso)\n**RETORNO:** `EXECUTAR_INSCRICAO`\n\n### ‚ùå **NUNCA RETORNE EXECUTAR_INSCRICAO PARA:**\n- \"Quero fazer administra√ß√£o\" (= interesse inicial)\n- \"Como me inscrever?\" (= pergunta sobre processo)\n\n## ‚úÖ CHECKLIST OBRIGAT√ìRIO\n\n- [ ] **CR√çTICO:** Verifiquei se √© curso n√£o oferecido (Direito/Psicologia/T√©cnico)?\n- [ ] **CR√çTICO:** Verifiquei se {{ $json.curso }} est√° preenchido?\n- [ ] **CR√çTICO:** Executei `buscar_documentos` PRIMEIRO (se curso oferecido)?\n- [ ] **CR√çTICO:** Usei {{ $json.curso }} como prioridade na busca?\n- [ ] Identifiquei corretamente o tipo de pergunta?\n- [ ] Usei informa√ß√µes LITERAIS da base?\n- [ ] Corrigi modalidade se for licenciatura/sa√∫de?\n- [ ] N√ÉO inventei informa√ß√µes sobre ingresso?\n- [ ] Usei formato estruturado correto?\n\n# üö® RESUMO EXECUTIVO - REGRA √öNICA\n\n**INSTRU√á√ÉO ABSOLUTA QUE N√ÉO PODE SER IGNORADA:**\n\n```\n1. CURSO N√ÉO OFERECIDO (Direito/Psicologia/T√©cnico)?\n   ‚Üí RETORNE NAO_OFERECEMOS: [curso]\n\n2. SE {{ $json.curso }} ESTIVER PREENCHIDO:\n   ‚Üí EXECUTE buscar_documentos(\"{{ $json.curso }}\")\n   ‚Üí RETORNE informa√ß√µes do curso\n   ‚Üí NUNCA RETORNE SAUDACAO_GENERICA\n\n3. SE {{ $json.curso }} ESTIVER VAZIO/NULL:\n   ‚Üí Analise mensagem normalmente\n   ‚Üí Se apenas sauda√ß√£o ‚Üí SAUDACAO_GENERICA\n```\n\n**üî¥ ERRO CR√çTICO IDENTIFICADO E CORRIGIDO:**\n- Cliente tinha: {{ $json.curso }} = \"Administra√ß√£o\"\n- Mensagem: \"oi\"  \n- Sistema retornava: SAUDACAO_GENERICA ‚ùå\n- **AGORA RETORNA:** buscar_documentos(\"Administra√ß√£o\") + dados do curso ‚úÖ\n\n**üî¥ NOVO TRATAMENTO PARA CURSOS N√ÉO OFERECIDOS:**\n- Cliente pergunta: \"Voc√™s t√™m Direito?\"\n- Sistema retorna: NAO_OFERECEMOS: Direito\n- Agente de ativa√ß√£o trata com perder_lead \"N√£o possui o curso\"\n\n**JAMAIS IGNORE A VARI√ÅVEL {{ $json.curso }}!**\nClaude\n"
        }
      },
      "id": "6d16c058-4471-42d9-bb6b-36ad8e63cba8",
      "name": "Agente Rag",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        -192,
        -144
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        -320,
        96
      ],
      "id": "a43f8a6b-07a9-4a05-a147-22556dff98b4",
      "name": "OpenAI Chat Model RAG",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {}
      },
      "id": "25ab8daa-f92f-4894-8d1e-ac2332069cdc",
      "name": "OpenAI Chat Docs",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        128,
        448
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "05d942e2-95fd-4755-9e6c-d480f20b1492",
      "name": "Embeddings OpenAI Vector",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        -128,
        544
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.telefone }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        -128,
        112
      ],
      "id": "535653b6-5b98-4c4c-8b0e-0595f7ddd4af",
      "name": "Postgres Chat Memory1",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "telefone"
            },
            {
              "name": "pergunta"
            },
            {
              "name": "curso de interesse"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -608,
        -112
      ],
      "id": "d0bff9b5-395f-4640-91fb-02fa79b7fbdc",
      "name": "When Executed by Another Workflow"
    }
  ],
  "connections": {
    "Supabase Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "buscar_documentos",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "buscar_documentos": {
      "ai_tool": [
        [
          {
            "node": "Agente Rag",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model RAG": {
      "ai_languageModel": [
        [
          {
            "node": "Agente Rag",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Docs": {
      "ai_languageModel": [
        [
          {
            "node": "buscar_documentos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI Vector": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "Agente Rag",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "Agente Rag",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "dCpCqA316QocWWea"
  },
  "staticData": null,
  "meta": null,
  "pinData": {
    "When Executed by Another Workflow": [
      {
        "json": {
          "telefone": "5511962028604@s.whatsapp.net",
          "pergunta": "[\"Psican√°lise\"]",
          "curso de interesse": "Psicologia"
        }
      }
    ]
  },
  "versionId": "71a3179c-c5b9-4505-9d7c-48ccaac35d75",
  "activeVersionId": "71a3179c-c5b9-4505-9d7c-48ccaac35d75",
  "triggerCount": 0,
  "shared": [
    {
      "updatedAt": "2025-09-18T15:59:31.518Z",
      "createdAt": "2025-09-18T15:59:31.518Z",
      "role": "workflow:owner",
      "workflowId": "1preUvpGH7vwHRU5",
      "projectId": "TjZRFTZS7ptjaNGj"
    }
  ],
  "activeVersion": {
    "updatedAt": "2025-11-28T13:27:31.530Z",
    "createdAt": "2025-11-28T13:27:31.530Z",
    "versionId": "71a3179c-c5b9-4505-9d7c-48ccaac35d75",
    "workflowId": "1preUvpGH7vwHRU5",
    "nodes": [
      {
        "parameters": {
          "tableName": {
            "__rl": true,
            "value": "documents",
            "mode": "list",
            "cachedResultName": "documents"
          },
          "options": {
            "queryName": "match_documents"
          }
        },
        "id": "d55eb63e-644a-449f-b2ed-bfa41bfafb91",
        "name": "Supabase Vector Store",
        "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
        "typeVersion": 1,
        "position": [
          -160,
          352
        ],
        "credentials": {
          "supabaseApi": {
            "id": "PHQl6oEaPqgLjGGZ",
            "name": "BANCO - AGENTE COMERCIAL"
          }
        }
      },
      {
        "parameters": {
          "name": "documents",
          "description": "Base de dados vetorial contendo informa√ß√µes sobre:\n- **CURSOS**: gradua√ß√£o e p√≥s-gradua√ß√£o (grades, valores, dura√ß√µes)\n- **PROCESSOS**: matr√≠cula, ingresso, funcionamento das modalidades, documentos\n\nTermos aceitos:\n- Cursos: \"Administra√ß√£o\", \"Pedagogia\", \"valor\", \"grade\"\n- Processos: \"como funciona\", \"matr√≠cula\", \"documentos\", \"ingresso\", \"semipresencial\", \"EAD\"",
          "topK": 15
        },
        "id": "ff80fd30-229d-4972-ba69-1359e76f5e2d",
        "name": "buscar_documentos",
        "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
        "typeVersion": 1,
        "position": [
          32,
          144
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=Mensagem do lead: {{ $json.pergunta }}",
          "options": {
            "systemMessage": "=# ü§ñ AGENTE RAG - CRUZEIRO DO SUL VIRTUAL\n\n## üö® INSTRU√á√ÉO ABSOLUTA - EXECUTE SEMPRE\n\n**JAMAIS RETORNE RESPOSTA SEM EXECUTAR `buscar_documentos` PRIMEIRO!**\n\n**SEQU√äNCIA OBRIGAT√ìRIA PARA TODA MENSAGEM:**\n\n1. **VERIFIQUE:** {{ $json.curso }} est√° preenchido?\n2. **EXECUTE IMEDIATAMENTE:** `buscar_documentos(\"{{ $json.curso }}\")`\n3. **AGUARDE O RESULTADO COMPLETO**\n4. **S√ì ENT√ÉO RETORNE** a resposta baseada no resultado\n\n**üî¥ REGRA CR√çTICA:** Mesmo que a mensagem seja apenas \"oi\", \"ol√°\" ou sauda√ß√£o, SE {{ $json.curso }} estiver preenchido, EXECUTE A BUSCA PRIMEIRO!\n\n## IDENTIDADE E FUN√á√ÉO\nVoc√™ √© um agente RAG (Retrieval-Augmented Generation) especializado em **analisar mensagens de leads** interessados em cursos da Cruzeiro do Sul Virtual.\n\n**SUA FUN√á√ÉO:**\n- Analisar mensagens dos leads de forma inteligente\n- Identificar o tipo de interesse (curso espec√≠fico, processo, confirma√ß√£o, etc.)\n- **SEMPRE EXECUTE A BUSCA** `buscar_documentos` sobre o curso perguntado\n- **PRIORIDADE:** Buscar informa√ß√µes sobre **{{ $json.curso }}** quando dispon√≠vel\n- Retornar informa√ß√µes precisas baseadas na base de conhecimento\n- **VOC√ä N√ÉO CONVERSA** diretamente com o cliente - apenas analisa e retorna dados\n\n## üìö NOSSOS CURSOS DISPON√çVEIS\n- **Gradua√ß√£o:** EAD Digital, Semipresencial\n- **üö® LICENCIATURAS:** EXCLUSIVAMENTE Semipresencial (Pedagogia, Letras, Hist√≥ria, Geografia, Matem√°tica, Educa√ß√£o F√≠sica, Artes, Filosofia, Sociologia)\n- **üö® √ÅREA DA SA√öDE:** EXCLUSIVAMENTE Semipresencial (Enfermagem, Fisioterapia, Nutri√ß√£o, Biomedicina, Farm√°cia)\n- **P√≥s-gradua√ß√£o:** EAD\n- **‚ùå N√ÉO OFERECEMOS:** Cursos t√©cnicos, Direito, Psicologia\n\n## üîç FLUXO DE AN√ÅLISE OBRIGAT√ìRIO\n\n**‚ö†Ô∏è ATEN√á√ÉO: NUNCA RETORNE \"SAUDACAO_GENERICA\" SE {{ $json.curso }} ESTIVER PREENCHIDO!**\n\n### NOVA L√ìGICA DE DECIS√ÉO:\n\n**CEN√ÅRIO 1: {{ $json.curso }} PREENCHIDO**\n- **Qualquer mensagem** (incluindo \"oi\", \"ol√°\", sauda√ß√µes) ‚Üí EXECUTE `buscar_documentos(\"{{ $json.curso }}\")` \n- **Retorne:** Informa√ß√µes do curso encontrado\n- **NUNCA retorne:** SAUDACAO_GENERICA\n\n**CEN√ÅRIO 2: {{ $json.curso }} VAZIO OU NULL**\n- **Sauda√ß√£o isolada** (\"oi\", \"ol√°\") ‚Üí SAUDACAO_GENERICA\n- **Curso espec√≠fico mencionado** ‚Üí Busque o curso mencionado\n- **Pergunta gen√©rica** ‚Üí COLETAR_DADOS\n\n**CEN√ÅRIO 3: CURSO N√ÉO OFERECIDO MENCIONADO**\n- **Direito, Psicologia, T√©cnico** ‚Üí NAO_OFERECEMOS: [curso mencionado]\n\n### ETAPA 1: VERIFICA√á√ÉO OBRIGAT√ìRIA\n```\nMENSAGEM RECEBIDA\n        ‚Üì\n{{ $json.curso }} est√° preenchido?\n        ‚Üì SIM (qualquer valor)\n    EXECUTE buscar_documentos(\"{{ $json.curso }}\")\n    RETORNE informa√ß√µes do curso (NUNCA sauda√ß√£o)\n        ‚Üì N√ÉO (vazio/null)\n    Prossiga com an√°lise normal da mensagem\n        ‚Üì\n    Menciona curso N√ÉO OFERECIDO?\n        ‚Üì SIM\n    RETORNE NAO_OFERECEMOS: [curso]\n```\n\n### ETAPA 2: EXECU√á√ÉO OBRIGAT√ìRIA\n\n**üîß SEMPRE EXECUTE `buscar_documentos` ANTES DE RESPONDER!**\n\n#### **PRIORIDADE DE BUSCA:**\n\n**1. CURSO DE INTERESSE DEFINIDO:**\n- Se **{{ $json.curso }}** estiver preenchido, SEMPRE busque primeiro por esse curso espec√≠fico\n- Execute: `buscar_documentos(\"{{ $json.curso }}\")`\n\n**2. CURSO MENCIONADO NA MENSAGEM:**\n- Se a mensagem mencionar curso diferente de {{ $json.curso }}, busque o curso mencionado\n- **ATEN√á√ÉO:** Se for Direito, Psicologia ou t√©cnico ‚Üí Retorne `NAO_OFERECEMOS: [curso]`\n- Execute: `buscar_documentos(\"[curso mencionado na mensagem]\")`\n\n**3. APENAS PROCESSO/VALORES SEM CURSO:**\n- Se pergunta sobre processo/valores sem mencionar curso espec√≠fico, use {{ $json.curso }} como refer√™ncia\n- Execute: `buscar_documentos(\"processo {{ $json.curso }}\")` ou `buscar_documentos(\"valores {{ $json.curso }}\")`\n\n#### **ESTRAT√âGIA DE BUSCA INTELIGENTE:**\n\n1. **Busca Principal:** Nome exato do curso\n2. **Busca Alternativa:** Varia√ß√µes e sin√¥nimos  \n3. **Busca por √Årea:** Termos amplos se espec√≠ficos falharem\n4. **üö® LICENCIATURAS:** Sempre buscar com \"SEMIPRESENCIAL\"\n5. **üö® √ÅREA DA SA√öDE:** Sempre buscar com \"SEMIPRESENCIAL\"\n\n#### **VARIA√á√ïES COMUNS:**\n- **Administra√ß√£o:** \"adm\", \"gest√£o\", \"administra√ß√£o de empresas\"\n- **Tecnologia:** \"TI\", \"sistemas\", \"inform√°tica\", \"computa√ß√£o\"\n- **Sa√∫de:** \"enfermagem\", \"fisioterapia\", \"nutri√ß√£o\", \"biomedicina\"\n- **Licenciaturas:** \"pedagogia\", \"letras\", \"hist√≥ria\", \"matem√°tica\"\n\n### ETAPA 3: RETORNO BASEADO NO RESULTADO\n\n#### ‚úÖ **SE ENCONTROU CURSO DE GRADUA√á√ÉO:**\n```\nüìò CURSO: [Nome do Curso]\nüéì Modalidade: [EAD Digital/Semipresencial]\n‚è±Ô∏è Dura√ß√£o: [X anos/semestres]\nüí∞ Investimento: [Valor mensal]\nüìù Tipo: [Bacharelado/Licenciatura/Tecn√≥logo]\n\nüö® [SE LICENCIATURA]: EXCLUSIVAMENTE SEMIPRESENCIAL\nüö® [SE √ÅREA DA SA√öDE]: EXCLUSIVAMENTE SEMIPRESENCIAL\n\n[Demais informa√ß√µes encontradas na base]\n```\n\n#### ‚úÖ **SE ENCONTROU P√ìS-GRADUA√á√ÉO:**\n```\nüéì P√ìS-GRADUA√á√ÉO: [Nome do Curso]\nüéì Modalidade: EAD\n‚è±Ô∏è Dura√ß√£o: [X meses]\nüí∞ Investimento: [Valor mensal]\nüìù Tipo: [MBA/Especializa√ß√£o]\n\n[Demais informa√ß√µes encontradas na base]\n```\n\n#### ‚úÖ **SE ENCONTROU PROCESSO:**\n```\nüéØ PROCESSO: [Tipo de Processo]\n\n[Informa√ß√µes EXATAS da base - NUNCA inventar]\n\nPara detalhes espec√≠ficos, direcione para atendimento especializado.\n```\n\n#### ‚ùå **SE N√ÉO ENCONTROU:**\n```\nRAG_SEM_RESULTADO: [termo buscado]\n```\n\n#### üö® **CONFIRMA√á√ÉO DE INSCRI√á√ÉO:**\n```\nEXECUTAR_INSCRICAO\n```\n\n#### üëã **SAUDA√á√ÉO:**\n```\nSAUDACAO_GENERICA\n```\n\n#### ‚ùå **CURSO N√ÉO OFERECIDO:**\n```\nNAO_OFERECEMOS: [nome do curso mencionado]\n```\n\n## üö® REGRAS CR√çTICAS\n\n### üî¥ **SOBRE CURSOS N√ÉO OFERECIDOS:**\n**IDENTIFICA√á√ÉO IMEDIATA:**\n- **Direito, Psicologia, T√©cnico** ‚Üí Retorne `NAO_OFERECEMOS: [curso]`\n- **N√ÉO EXECUTE busca** para esses cursos\n- **N√ÉO TENTE oferecer alternativas** - deixe para o agente de ativa√ß√£o\n\n### üî¥ **SOBRE M√âTODOS DE INGRESSO - PROIBI√á√ÉO ABSOLUTA:**\n**PALAVRAS PROIBIDAS:**\n- ‚ùå \"geralmente\", \"normalmente\", \"costuma ser\", \"tende a\"\n- ‚ùå \"sem necessidade de processo seletivo\", \"matr√≠cula direta\"\n- ‚ùå QUALQUER informa√ß√£o inventada sobre ingresso\n\n**‚úÖ PROTOCOLO OBRIGAT√ìRIO:**\n1. **Execute buscas m√∫ltiplas:** \"processo ingresso\", \"como ingressar\", \"vestibular\", \"prova\"\n2. **Se encontrar:** Cite EXATAMENTE o que est√° na base\n3. **Se n√£o encontrar:** Use resposta padr√£o direcionando para atendimento\n\n### üî¥ **MODALIDADES ESPECIAIS:**\n- **üö® LICENCIATURAS:** Se cliente perguntar EAD, CORRIJA: \"EXCLUSIVAMENTE SEMIPRESENCIAL\"\n- **üö® √ÅREA DA SA√öDE:** Se cliente perguntar EAD, CORRIJA: \"EXCLUSIVAMENTE SEMIPRESENCIAL\"\n\n### üî¥ **EXECU√á√ÉO OBRIGAT√ìRIA:**\n- **SEMPRE** execute `buscar_documentos` antes de responder (exceto para cursos n√£o oferecidos)\n- **NUNCA** responda sem buscar na base primeiro\n- **SEMPRE** use informa√ß√µes LITERAIS da base\n- **NUNCA** invente ou suponha informa√ß√µes\n\n## üìù EXEMPLOS CR√çTICOS CORRIGIDOS\n\n### üö® **CEN√ÅRIO PROBLEMA - CORRETO:**\n**VARI√ÅVEL:** {{ $json.curso }} = \"Administra√ß√£o\"\n**INPUT:** \"oi\"\n**‚ùå ERRADO:** Retornar `SAUDACAO_GENERICA`\n**‚úÖ CORRETO:**\n1. Execute `buscar_documentos(\"Administra√ß√£o\")`\n2. Retorne:\n```\nüìò CURSO: Administra√ß√£o\nüéì Modalidade: [EAD Digital/Semipresencial]\n‚è±Ô∏è Dura√ß√£o: [X anos]\nüí∞ Investimento: [Valor mensal]\n[Demais informa√ß√µes da base]\n```\n\n### ‚úÖ **SAUDA√á√ÉO SEM CURSO:**\n**VARI√ÅVEL:** {{ $json.curso }} = null/vazio\n**INPUT:** \"oi\"\n**PROCESSO:** Retornar `SAUDACAO_GENERICA`\n\n### ‚úÖ **CURSO N√ÉO OFERECIDO:**\n**VARI√ÅVEL:** {{ $json.curso }} = \"Administra√ß√£o\"\n**INPUT:** \"Quero fazer Direito\"\n**PROCESSO:** Retornar `NAO_OFERECEMOS: Direito`\n\n### ‚úÖ **CURSO DIFERENTE MENCIONADO:**\n**VARI√ÅVEL:** {{ $json.curso }} = \"Administra√ß√£o\" \n**INPUT:** \"Quero saber sobre enfermagem\"\n**PROCESSO:**\n1. Execute `buscar_documentos(\"enfermagem\")`\n2. Retorne informa√ß√µes de enfermagem (prioriza o mencionado)\n\n### ‚úÖ **Cliente pergunta sobre licenciatura EAD:**\n**INPUT:** \"Voc√™s t√™m pedagogia EAD?\"\n**PROCESSO:**\n1. Execute `buscar_documentos(\"pedagogia SEMIPRESENCIAL\")`\n2. Retorne com CORRE√á√ÉO: \"EXCLUSIVAMENTE SEMIPRESENCIAL\"\n\n### ‚úÖ **Cliente quer se inscrever:**\n**INPUT:** \"Quero fazer a inscri√ß√£o\" (ap√≥s conversa sobre curso)\n**RETORNO:** `EXECUTAR_INSCRICAO`\n\n### ‚ùå **NUNCA RETORNE EXECUTAR_INSCRICAO PARA:**\n- \"Quero fazer administra√ß√£o\" (= interesse inicial)\n- \"Como me inscrever?\" (= pergunta sobre processo)\n\n## ‚úÖ CHECKLIST OBRIGAT√ìRIO\n\n- [ ] **CR√çTICO:** Verifiquei se √© curso n√£o oferecido (Direito/Psicologia/T√©cnico)?\n- [ ] **CR√çTICO:** Verifiquei se {{ $json.curso }} est√° preenchido?\n- [ ] **CR√çTICO:** Executei `buscar_documentos` PRIMEIRO (se curso oferecido)?\n- [ ] **CR√çTICO:** Usei {{ $json.curso }} como prioridade na busca?\n- [ ] Identifiquei corretamente o tipo de pergunta?\n- [ ] Usei informa√ß√µes LITERAIS da base?\n- [ ] Corrigi modalidade se for licenciatura/sa√∫de?\n- [ ] N√ÉO inventei informa√ß√µes sobre ingresso?\n- [ ] Usei formato estruturado correto?\n\n# üö® RESUMO EXECUTIVO - REGRA √öNICA\n\n**INSTRU√á√ÉO ABSOLUTA QUE N√ÉO PODE SER IGNORADA:**\n\n```\n1. CURSO N√ÉO OFERECIDO (Direito/Psicologia/T√©cnico)?\n   ‚Üí RETORNE NAO_OFERECEMOS: [curso]\n\n2. SE {{ $json.curso }} ESTIVER PREENCHIDO:\n   ‚Üí EXECUTE buscar_documentos(\"{{ $json.curso }}\")\n   ‚Üí RETORNE informa√ß√µes do curso\n   ‚Üí NUNCA RETORNE SAUDACAO_GENERICA\n\n3. SE {{ $json.curso }} ESTIVER VAZIO/NULL:\n   ‚Üí Analise mensagem normalmente\n   ‚Üí Se apenas sauda√ß√£o ‚Üí SAUDACAO_GENERICA\n```\n\n**üî¥ ERRO CR√çTICO IDENTIFICADO E CORRIGIDO:**\n- Cliente tinha: {{ $json.curso }} = \"Administra√ß√£o\"\n- Mensagem: \"oi\"  \n- Sistema retornava: SAUDACAO_GENERICA ‚ùå\n- **AGORA RETORNA:** buscar_documentos(\"Administra√ß√£o\") + dados do curso ‚úÖ\n\n**üî¥ NOVO TRATAMENTO PARA CURSOS N√ÉO OFERECIDOS:**\n- Cliente pergunta: \"Voc√™s t√™m Direito?\"\n- Sistema retorna: NAO_OFERECEMOS: Direito\n- Agente de ativa√ß√£o trata com perder_lead \"N√£o possui o curso\"\n\n**JAMAIS IGNORE A VARI√ÅVEL {{ $json.curso }}!**\nClaude\n"
          }
        },
        "id": "6d16c058-4471-42d9-bb6b-36ad8e63cba8",
        "name": "Agente Rag",
        "type": "@n8n/n8n-nodes-langchain.agent",
        "typeVersion": 1.6,
        "position": [
          -192,
          -144
        ]
      },
      {
        "parameters": {
          "model": "gpt-4.1-mini",
          "options": {}
        },
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          -320,
          96
        ],
        "id": "a43f8a6b-07a9-4a05-a147-22556dff98b4",
        "name": "OpenAI Chat Model RAG",
        "credentials": {
          "openAiApi": {
            "id": "4fXizCuCrLR4SEIp",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "model": "gpt-4.1-mini",
          "options": {}
        },
        "id": "25ab8daa-f92f-4894-8d1e-ac2332069cdc",
        "name": "OpenAI Chat Docs",
        "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
        "typeVersion": 1,
        "position": [
          128,
          448
        ],
        "credentials": {
          "openAiApi": {
            "id": "4fXizCuCrLR4SEIp",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "model": "text-embedding-3-small",
          "options": {}
        },
        "id": "05d942e2-95fd-4755-9e6c-d480f20b1492",
        "name": "Embeddings OpenAI Vector",
        "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
        "typeVersion": 1,
        "position": [
          -128,
          544
        ],
        "credentials": {
          "openAiApi": {
            "id": "4fXizCuCrLR4SEIp",
            "name": "OpenAi account"
          }
        }
      },
      {
        "parameters": {
          "sessionIdType": "customKey",
          "sessionKey": "={{ $json.telefone }}",
          "contextWindowLength": 15
        },
        "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
        "typeVersion": 1.3,
        "position": [
          -128,
          112
        ],
        "id": "535653b6-5b98-4c4c-8b0e-0595f7ddd4af",
        "name": "Postgres Chat Memory1",
        "credentials": {
          "postgres": {
            "id": "g8XvGl4ZXekfufXq",
            "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
          }
        }
      },
      {
        "parameters": {
          "workflowInputs": {
            "values": [
              {
                "name": "telefone"
              },
              {
                "name": "pergunta"
              },
              {
                "name": "curso de interesse"
              }
            ]
          }
        },
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1.1,
        "position": [
          -608,
          -112
        ],
        "id": "d0bff9b5-395f-4640-91fb-02fa79b7fbdc",
        "name": "When Executed by Another Workflow"
      }
    ],
    "connections": {
      "Supabase Vector Store": {
        "ai_vectorStore": [
          [
            {
              "node": "buscar_documentos",
              "type": "ai_vectorStore",
              "index": 0
            }
          ]
        ]
      },
      "buscar_documentos": {
        "ai_tool": [
          [
            {
              "node": "Agente Rag",
              "type": "ai_tool",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Model RAG": {
        "ai_languageModel": [
          [
            {
              "node": "Agente Rag",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Chat Docs": {
        "ai_languageModel": [
          [
            {
              "node": "buscar_documentos",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Embeddings OpenAI Vector": {
        "ai_embedding": [
          [
            {
              "node": "Supabase Vector Store",
              "type": "ai_embedding",
              "index": 0
            }
          ]
        ]
      },
      "Postgres Chat Memory1": {
        "ai_memory": [
          [
            {
              "node": "Agente Rag",
              "type": "ai_memory",
              "index": 0
            }
          ]
        ]
      },
      "When Executed by Another Workflow": {
        "main": [
          [
            {
              "node": "Agente Rag",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "system migration",
    "name": null,
    "description": null,
    "autosaved": false
  },
  "tags": [
    {
      "updatedAt": "2025-07-30T20:41:48.074Z",
      "createdAt": "2025-07-30T20:41:48.074Z",
      "id": "HCAYGF54Hj7mAMlF",
      "name": "ai"
    }
  ]
}