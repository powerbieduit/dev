{
  "createdAt": "2025-08-01T18:06:31.806Z",
  "updatedAt": "2025-08-12T15:15:01.000Z",
  "id": "BCqJCvpayVUGyyft",
  "name": "disparos automaticos",
  "active": false,
  "isArchived": true,
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "cronExpression",
              "expression": "*/10 8-17 * * 1-5"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        128,
        320
      ],
      "id": "92dd9421-32e8-4f84-8334-eaba25f5af5f",
      "name": "Schedule Trigger2"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "581d8fef-130d-439f-b3b3-53f3ed1a5dbb",
              "leftValue": "={{ $now }}",
              "rightValue": "={{ $json.updated_at.toDateTime().plus('30', 'minutes') }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "381c3301-7d5b-4592-8c41-f505f02684a2",
              "leftValue": "={{ $now }}",
              "rightValue": "={{ $json.updated_at.toDateTime().plus('2', 'hours') }}",
              "operator": {
                "type": "dateTime",
                "operation": "before"
              }
            },
            {
              "id": "659f198d-0d1a-47e8-98fe-812907c3cd6f",
              "leftValue": "={{ $json.etapa_followup }}",
              "rightValue": 0,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        880,
        144
      ],
      "id": "585b12fa-565c-4257-8f11-5ae5a6a7c894",
      "name": "30 min"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "581d8fef-130d-439f-b3b3-53f3ed1a5dbb",
              "leftValue": "={{ $now }}",
              "rightValue": "={{ $json.updated_at.toDateTime().plus('2', 'hours') }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "3be9ed53-70ef-48ba-9083-0f235d51799b",
              "leftValue": "={{ $now }}",
              "rightValue": "={{ $json.updated_at.toDateTime().plus('1', 'day') }}",
              "operator": {
                "type": "dateTime",
                "operation": "before"
              }
            },
            {
              "id": "a44c4b57-126a-41e2-afc8-e0d4e916c97f",
              "leftValue": "={{ $json.etapa_followup }}",
              "rightValue": 1,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        880,
        352
      ],
      "id": "7133515c-8a8d-47df-b67a-1a48493714e5",
      "name": "2h"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "581d8fef-130d-439f-b3b3-53f3ed1a5dbb",
              "leftValue": "={{ $now }}",
              "rightValue": "={{ $json.updated_at.toDateTime().plus('1', 'day') }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "d1a681cf-0504-4d5c-8a8b-49c8eb73997f",
              "leftValue": "={{ $json.etapa_followup }}",
              "rightValue": 2,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            },
            {
              "id": "2c8a467c-6124-4e1c-b887-41868d76c481",
              "leftValue": "={{ $now }}",
              "rightValue": "={{ $json.updated_at.toDateTime().plus('2', 'day') }}",
              "operator": {
                "type": "dateTime",
                "operation": "before"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        880,
        528
      ],
      "id": "c95e457b-8f5f-4d2a-bb92-950b31910a75",
      "name": "24h"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        528,
        320
      ],
      "id": "d5a5bd1e-1957-474c-9367-3d55a7926dd8",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Você é um assistente de follow-up. Analise o histórico da última conversa com o número {{ $('Listar Chats').item.json.phone }} e crie uma mensagem de follow-up.\n\n**REGRAS IMPORTANTES:**\n- Responda APENAS com a mensagem final para o cliente\n- NÃO inclua explicações, introduções ou instruções\n- NÃO diga \"Aqui está a mensagem\" ou similares\n- NÃO adicione comentários sobre a mensagem\n- A resposta deve ser SOMENTE o texto que será enviado ao cliente\n\n**FORMATO DA MENSAGEM:**\n- Use formatação WhatsApp (emojis, quebras de linha)\n- Tom amigável e profissional\n- Referência ao último contato\n- Call-to-action quando apropriado\n- Mensagem direta e personalizada\n\n**LEMBRE-SE:** Sua resposta deve ser EXCLUSIVAMENTE a mensagem que será enviada ao cliente. Nada mais.",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2,
      "position": [
        1264,
        352
      ],
      "id": "5dae9b01-65a5-4ceb-b758-a5d86d6b6a66",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Listar Chats').item.json.phone }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        1344,
        544
      ],
      "id": "834e9563-c245-46cc-a5d0-a42d11e0a744",
      "name": "Postgres Chat Memory1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1200,
        544
      ],
      "id": "71ece62e-21ef-4e78-acd3-00d3b432186f",
      "name": "OpenAI Chat Model1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2208,
        352
      ],
      "id": "fcbca905-fc8a-4c43-b96a-ebdade4a5fa1",
      "name": "Wait3",
      "webhookId": "88302532-fa1b-4e15-b77a-e85dedce41a0"
    },
    {
      "parameters": {
        "content": "# Follow Up",
        "height": 840,
        "width": 2220,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        0,
        0
      ],
      "typeVersion": 1,
      "id": "61a4f518-d88b-4860-9345-6a2b246d0309",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "581d8fef-130d-439f-b3b3-53f3ed1a5dbb",
              "leftValue": "={{ $now }}",
              "rightValue": "={{ $json.updated_at.toDateTime().plus('2', 'day') }}",
              "operator": {
                "type": "dateTime",
                "operation": "after"
              }
            },
            {
              "id": "d1a681cf-0504-4d5c-8a8b-49c8eb73997f",
              "leftValue": "={{ $json.etapa_followup }}",
              "rightValue": 3,
              "operator": {
                "type": "number",
                "operation": "lte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.filter",
      "typeVersion": 2.2,
      "position": [
        880,
        688
      ],
      "id": "5833879d-e97e-4daf-a0d5-393f89f7e4e2",
      "name": "2 dias"
    }
  ],
  "connections": {
    "Schedule Trigger2": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "30 min": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2h": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "24h": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "2h",
            "type": "main",
            "index": 0
          },
          {
            "node": "30 min",
            "type": "main",
            "index": 0
          },
          {
            "node": "24h",
            "type": "main",
            "index": 0
          },
          {
            "node": "2 dias",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Wait3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Wait3": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "2 dias": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "meta": null,
  "pinData": {},
  "versionId": "ac072107-05e2-45f6-a8f7-6117bdeee4e4",
  "triggerCount": 0,
  "shared": [
    {
      "createdAt": "2025-08-01T18:06:31.812Z",
      "updatedAt": "2025-08-01T18:06:31.812Z",
      "role": "workflow:owner",
      "workflowId": "BCqJCvpayVUGyyft",
      "projectId": "TjZRFTZS7ptjaNGj"
    }
  ],
  "tags": []
}