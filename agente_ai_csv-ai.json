{
  "updatedAt": "2025-11-11T16:02:43.000Z",
  "createdAt": "2025-07-25T20:01:53.086Z",
  "id": "afID0dTfsm0vtXUX",
  "name": "agente_ai_csv",
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "id": "00f79506-a02c-467a-9ff3-0974e9cf02af",
      "name": "Loop Over Items3",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        12400,
        464
      ]
    },
    {
      "parameters": {
        "content": "# Splitar Mensagens",
        "height": 640,
        "width": 2396,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        10624,
        352
      ],
      "typeVersion": 1,
      "id": "c739e568-565d-4553-a87b-21ea8b5ee063",
      "name": "Sticky Note18"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {
          "maxTokens": 1200,
          "temperature": 0.4,
          "topP": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        9728,
        -288
      ],
      "id": "d9367a27-bb20-4242-bad4-82b9ad866dcc",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        11984,
        144
      ],
      "id": "072f0f59-58ca-42a3-838f-cc8aefdf3904",
      "name": "Merge1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "defac08a-6745-422b-bb05-90da9f47d91b",
              "leftValue": "={{ $('Busca Telefone').last().json.values() }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        11488,
        128
      ],
      "id": "035f9184-36af-44bb-9f73-9a1b63889764",
      "name": "If4"
    },
    {
      "parameters": {
        "content": "# Histórico Supabase\n",
        "height": 364,
        "width": 2028,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        10624,
        0
      ],
      "typeVersion": 1,
      "id": "20730bf1-a440-4873-8731-d672945fc1ce",
      "name": "Sticky Note54"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "keyValue": "={{ $('Code').item.json.telefoneCorreto }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        11328,
        128
      ],
      "id": "b87960ec-b936-405b-8dcc-e0b61e518df3",
      "name": "Busca Telefone",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "tableId": "chats",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Code').item.json.telefoneCorreto }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now.setZone(\"America/Sao_Paulo\").toISO() }}"
            },
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now.setZone(\"America/Sao_Paulo\").toISO() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        11712,
        48
      ],
      "id": "80d57a51-82e3-4ef8-b618-437736f18880",
      "name": "Adiciona CHAT supabase",
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Code').item.json.telefoneCorreto }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        11696,
        192
      ],
      "id": "00c3824b-47e7-483a-a032-46e7b3786c13",
      "name": "Atualiza CHAT Supabase",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "tableId": "chat_messages",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Code').item.json.telefoneCorreto }}"
            },
            {
              "fieldId": "bot_message",
              "fieldValue": "={{ $('orquestrador').first().json.output }}"
            },
            {
              "fieldId": "user_message",
              "fieldValue": "={{ $('Dados').first().json.message.content }}"
            },
            {
              "fieldId": "message_type",
              "fieldValue": "={{ $('Dados').first().json.body.event }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "id_lead",
              "fieldValue": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        12192,
        144
      ],
      "id": "1b7bbcd6-871c-44a7-b44e-c11d0a5b8e74",
      "name": "Cria Histórico Supabase",
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.messages",
        "options": {
          "destinationFieldName": "output"
        }
      },
      "id": "c52c47d3-7b80-4dd3-a1cb-acfbf1283ab9",
      "name": "Split de Mensagem",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        12192,
        432
      ]
    },
    {
      "parameters": {
        "amount": 1
      },
      "id": "90b80d3c-ae16-44b3-af33-d377563acf54",
      "name": "1 segundo",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        12912,
        464
      ],
      "webhookId": "a2c69e1c-13fe-44a2-962c-1249288537eb"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Dados').first().json.Telefone }}"
      },
      "id": "5af64095-e1bc-4b70-b015-a454ea2839d6",
      "name": "Delete Memory",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        12384,
        144
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "content": "# Enfileirar Mensagens\n",
        "height": 780,
        "width": 1916,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        6720,
        64
      ],
      "typeVersion": 1,
      "id": "8c0acb8f-ff19-4a1d-a32f-fca2ae47747b",
      "name": "Sticky Note17"
    },
    {
      "parameters": {
        "content": "# BUFFERING\n",
        "height": 780,
        "width": 2516,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4240,
        64
      ],
      "typeVersion": 1,
      "id": "1248d193-005f-4974-906d-edb9859945ec",
      "name": "Sticky Note20"
    },
    {
      "parameters": {
        "content": "# PAUSA",
        "height": 780,
        "width": 2100,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        880,
        64
      ],
      "typeVersion": 1,
      "id": "3a139bd5-534d-451e-8d74-46ae7a72bbff",
      "name": "Sticky Note26"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "comercial_cruzeiro",
        "options": {}
      },
      "id": "602d8256-7107-4d57-9d13-c62f674ee219",
      "name": "Webhook EVO",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        32,
        432
      ],
      "webhookId": "7ecd43ed-123c-4fef-b86d-f9ce39e55d64"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "a4377234-9405-48ea-a843-e903443fe310",
      "name": "Edit Fields3",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5632,
        544
      ]
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $json.telefoneCorreto }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "pause"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2176,
        32
      ],
      "id": "c68aa7b4-0e03-46fb-b15b-6002f8da7687",
      "name": "Pausar IA",
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.atendimento_ia }}",
                    "rightValue": "pause",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    },
                    "id": "ff00573b-e517-43c6-8644-14a4fe8565d1"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "IA Ativa"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "3ef0e01c-cc14-4663-bb4d-2905b350c3ab",
                    "leftValue": "={{ $json.atendimento_ia }}",
                    "rightValue": "=pause",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "IA pausada"
            }
          ]
        },
        "options": {}
      },
      "id": "571380e1-dc30-4174-b66d-0ec91924edc1",
      "name": "Rota Atendimento",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        2064,
        432
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "9865cb5b-33da-490c-afc3-186457d5b564",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    },
                    "leftValue": "={{ $('Dados').item.json.message.content }}",
                    "rightValue": "Atendimento finalizado"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "IA Pausada"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "id": "5a9a1fee-b408-469f-a08c-e8d690fc9792",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "leftValue": "={{ $('Normal ou Treinamento').item.json.message.content }}",
                    "rightValue": "Atendimento finalizado"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Reativar IA"
            }
          ]
        },
        "options": {}
      },
      "id": "ed6cbfda-687e-4400-a78b-5df9d31d1452",
      "name": "Rotas1",
      "type": "n8n-nodes-base.switch",
      "position": [
        1920,
        128
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $json.telefoneCorreto }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "reativada"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        2416,
        240
      ],
      "id": "a2afec9c-ecc3-40a5-afae-0519d3693633",
      "name": "Reativar IA",
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "11800d83-ecca-4f9c-a878-a2419db0c8e9",
              "name": "=message.chat_id",
              "value": "={{ $json.telefoneCorreto }}",
              "type": "string"
            },
            {
              "id": "c33f9527-e661-49e5-8e5e-64f3b430928a",
              "name": "=message.content_type",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation ? 'text' : '' }}{{ $('Webhook EVO').item.json.body.data.message.audioMessage ? 'audio' : '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage ? 'image' : '' }}",
              "type": "string"
            },
            {
              "id": "06eba1c9-cff0-4f68-b6da-6bb0092466b7",
              "name": "=message.content",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.extendedTextMessage?.text || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.caption || '' }}{{ $('Webhook EVO').item.json.body.data.message.conversation || '' }}",
              "type": "string"
            },
            {
              "id": "b97f1af3-5361-46fc-9303-d644921231d8",
              "name": "=message.timestamp",
              "value": "={{ $('Webhook EVO').item.json.body.data.messageTimestamp.toDateTime('s').toISO() }}",
              "type": "string"
            },
            {
              "id": "dc3dc59c-90a3-4a45-bea2-de092c91083b",
              "name": "=message.content_url",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.audioMessage?.url || '' }}{{ $('Webhook EVO').item.json.body.data.message.imageMessage?.url || '' }}",
              "type": "string"
            },
            {
              "id": "8b01a818-a456-476e-bace-adefe2f04eb4",
              "name": "message.event",
              "value": "={{ $('Webhook EVO').item.json.body.data.key.fromMe ? 'outcoming' : 'incoming' }}",
              "type": "string"
            },
            {
              "id": "886e3751-e39b-4fc6-98d1-3113eaeebbb4",
              "name": "=body.event",
              "value": "={{ $('Webhook EVO').item.json.body.event }}",
              "type": "string"
            },
            {
              "id": "d04a0c6e-7842-41d2-bdb0-c0ce51d6dad7",
              "name": "=Telefone",
              "value": "={{ $json.telefoneCorreto }}",
              "type": "string"
            },
            {
              "id": "a57db642-3e13-452e-bb5b-19f7e9f3bd5d",
              "name": "=NomeWhatsapp",
              "value": "={{ $('Webhook EVO').item.json.body.data.pushName }}",
              "type": "string"
            },
            {
              "id": "f5fcee3e-a786-404b-8b92-0163e02c6615",
              "name": "=Instance",
              "value": "={{ $('Webhook EVO').item.json.body.instance }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "776aff2e-f1c5-4975-a5f6-2d3997bc766f",
      "name": "Dados",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        544,
        448
      ]
    },
    {
      "parameters": {
        "amount": 1,
        "unit": "minutes"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2240,
        240
      ],
      "id": "0f7cc57a-c6e3-47d3-9166-311b206ca86e",
      "name": "Wait",
      "webhookId": "b9c0dc3b-a05b-4e71-bcbe-fee8c71142a2"
    },
    {
      "parameters": {
        "content": "# Configuração Banco de Dados",
        "height": 840,
        "width": 2312,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -368,
        896
      ],
      "typeVersion": 1,
      "id": "cafd46e4-89a3-45c4-b09c-592b6ec43954",
      "name": "Sticky Note12"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "ade56c50-1520-4760-8df5-e99617d6d3ad",
              "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.imageMessage.caption }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "6a3ec36a-220e-4470-a7cf-546b66422e23",
      "name": "If6",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        6640,
        592
      ]
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "Analise essa imagem e resuma pra mim o que ela é",
        "inputType": "base64",
        "options": {}
      },
      "id": "6bcb7bb1-06e3-4e14-8e66-7c483d362036",
      "name": "OpenAI2",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        6336,
        592
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "682e3656-f4ce-4e90-bab7-ddc74a275834",
      "name": "OpenAI4",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        6448,
        416
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "keyValue": "={{ $('Code').item.json.telefoneCorreto }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        768,
        464
      ],
      "id": "3eb313d1-d49b-47fe-9141-a861cfc5eaa3",
      "name": "Buscar Cliente",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4a6d9aac-8565-4c58-abe3-8741393a5535",
              "leftValue": "={{ $json.telefone }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "exists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        1056,
        480
      ],
      "id": "4a77a658-a49a-4d25-afe7-71e4c5a9dd00",
      "name": "Cliente Existe?",
      "retryOnFail": true
    },
    {
      "parameters": {
        "tableId": "dados_cliente",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "nomewpp",
              "fieldValue": "={{ $('Dados').item.json.NomeWhatsapp }}"
            },
            {
              "fieldId": "telefone",
              "fieldValue": "={{ $('Code').item.json.telefoneCorreto }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now.setZone(\"America/Sao_Paulo\").toISO() }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        1280,
        576
      ],
      "id": "e9a2521c-2670-415f-a01c-4825c4644b6d",
      "name": "Criar Cliente",
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Dados').item.json.message.event }}",
                    "rightValue": "outcoming",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "7c878f9b-2c93-4061-954a-a832153e7647"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "outcoming"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "d7b42536-638f-4128-b51b-6aa913e9d9bc",
                    "leftValue": "={{ $('Dados').item.json.message.event }}",
                    "rightValue": "incoming",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "incoming"
            }
          ]
        },
        "options": {}
      },
      "id": "af5f2298-bea5-499a-863c-034a10becec6",
      "name": "ROTA Entrando ou Saindo",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        1584,
        448
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.ogg",
          "mimeType": "application/ogg"
        }
      },
      "id": "7b206cd0-bed3-4121-84e4-d7ee7ec22f56",
      "name": "Converter Audio",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        6176,
        416
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.png",
          "mimeType": "image/png"
        }
      },
      "id": "5a436850-6711-41df-abb0-d7aa02ffbe96",
      "name": "Converter Foto",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        5936,
        608
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "extendedTextMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "e514e613-fd6a-48bd-b0ae-bae2448c810e",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "8e717a3a-742c-4dd1-883a-42833cf813e9"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "c0e434dd-1268-421d-b81b-3a5e90ed9550",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "38594d27-4ce1-4b6e-9dfc-ce5f2edca486",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "buttonMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "id": "9b24c7e1-a0d6-4ccb-9c9e-d08d553cce48",
      "name": "ROTA Mensagens",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        5248,
        352
      ]
    },
    {
      "parameters": {
        "content": "# Agente FUPPER\n",
        "height": 1228,
        "width": 1924,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8720,
        976
      ],
      "typeVersion": 1,
      "id": "7b005708-8712-408c-9dd4-12c6542a1961",
      "name": "Sticky Note16"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Code').item.json.telefoneCorreto }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        10096,
        -288
      ],
      "id": "e91938cf-ab01-4343-b3cc-3fd7e362338a",
      "name": "Postgres Chat Memory",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Dados').item.json.Telefone }}",
            "message": "={{ JSON.stringify({ \n      type: \"ai\",\n      content: $('Dados').item.json.message.content || '', \n      additional_kwargs: {}, \n      response_metadata: {} \n   }) }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        2400,
        576
      ],
      "id": "9cc64a6b-4676-489a-a8ca-61e2a0b8ed7b",
      "name": "Salvar Historico",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "n8n_chat_histories",
          "mode": "list",
          "cachedResultName": "n8n_chat_histories"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "session_id": "={{ $('Dados').item.json.Telefone }}",
            "message": "={\"type\": \"human\", \"content\": \"{{ $('Normal ou Treinamento').item.json.message.content.replace(/\\n/g, ' ') }}\", \"additional_kwargs\": {}, \"response_metadata\": {}}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "session_id",
              "displayName": "session_id",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "message",
              "displayName": "message",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        2640,
        128
      ],
      "id": "db888d90-dc9d-4e8e-9d34-920428442dc3",
      "name": "Salvar Historico1",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        8704,
        608
      ],
      "id": "b698989c-6ea4-4432-982e-980928ddb7c6",
      "name": "No Operation, do nothing"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2800,
        112
      ],
      "id": "e176a487-085f-431d-8ead-9a710cbf787d",
      "name": "No Operation, do nothing1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        2688,
        576
      ],
      "id": "d74ec295-a775-4ee2-9fc9-d59069d8400d",
      "name": "No Operation, do nothing2"
    },
    {
      "parameters": {
        "amount": 15
      },
      "id": "01633671-792f-4dbc-9bd6-ad8026ea8576",
      "name": "Intervalo entre Mensagens",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        7760,
        400
      ],
      "webhookId": "9f0edf0b-ca36-42a6-bab6-bf62ca08ac51"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Code').item.json.telefoneCorreto }}",
        "messageData": "={{ $('Dados').item.json.message.content }}",
        "tail": true
      },
      "id": "41c1e92f-1523-4d29-bdc5-f7ffebeab0a0",
      "name": "Texto Redis",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        6080,
        144
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $json.text }}",
        "tail": true
      },
      "id": "20357602-c607-49a4-a13a-49e6983dd24f",
      "name": "Audio Redis",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        6672,
        432
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "db975a2b-d4f1-4b9b-b9ad-61d312141f9c",
      "name": "imagem Redis",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        7104,
        480
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $('Dados').item.json.message.content }}, {{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "e7f58a93-e164-45f1-b716-594520b279e4",
      "name": "Imagem Redis",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        7120,
        624
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Code').item.json.telefoneCorreto }}",
        "options": {}
      },
      "id": "60cb757b-b9d3-497e-8438-a19fbf13d36f",
      "name": "Buscas Mensagens",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        8048,
        384
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "239cab79-8fb1-45ca-9a04-11006892d52e",
              "name": "mensagem_completa",
              "value": "={{ $json.propertyName }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        8480,
        336
      ],
      "id": "3d4e3fdf-b6e8-4e0d-a0c9-39a419c6223a",
      "name": "Mensagem Completa1"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Code').item.json.telefoneCorreto }}"
      },
      "id": "919b688c-93df-43d8-b072-c2043af478b9",
      "name": "Deletar Mensagens",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        8688,
        352
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE TABLE chat_messages (\n  id BIGSERIAL PRIMARY KEY,\n  created_at TIMESTAMPTZ, \n  phone TEXT,\n  nomewpp TEXT, \n  bot_message TEXT,\n  user_message TEXT, \n  message_type TEXT,\n  active BOOLEAN DEFAULT TRUE\n);\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -288,
        1056
      ],
      "id": "cd60fdff-566d-472b-87c4-455b6fdf9adb",
      "name": "chat_messages",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create table dados_cliente (\n  id bigserial primary key,\n  created_at TIMESTAMPTZ, \n  telefone text, \n  nomewpp text,\n  atendimento_ia text\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        112,
        1056
      ],
      "id": "df63e760-f356-4e2e-9575-e5d8415533fa",
      "name": "dados_cliente",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create table chats (\n  id bigserial primary key,\n  created_at TIMESTAMPTZ, \n  phone text,\n  updated_at text\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        736,
        1056
      ],
      "id": "b763abad-b368-4911-a822-6b8d420f6143",
      "name": "chats",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create extension vector;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -96,
        1056
      ],
      "id": "34bc1642-0494-4f35-9fce-fc1dc64650d6",
      "name": "vetor",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "create function match_documents (\n  query_embedding vector(1536),\n  match_count int default null,\n  filter jsonb DEFAULT '{}'\n) returns table (\n  id bigint,\n  content text,\n  metadata jsonb,\n  similarity float\n)\nlanguage plpgsql\nas $$\n#variable_conflict use_column\nbegin\n  return query\n  select\n    id,\n    content,\n    metadata,\n    1 - (documents.embedding <=> query_embedding) as similarity\n  from documents\n  where metadata @> filter\n  order by documents.embedding <=> query_embedding\n  limit match_count;\nend;\n$$;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        512,
        1056
      ],
      "id": "063250e4-d7bc-4e9a-a990-cdece81965bc",
      "name": "match_documents",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Create a table to store your documents\ncreate table documents (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        304,
        1056
      ],
      "id": "df2373cf-1419-436a-9f31-b8283b710158",
      "name": "documents",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "content": "## Criação\n",
        "height": 324,
        "width": 2224,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -320,
        976
      ],
      "typeVersion": 1,
      "id": "7f1d437e-2570-424d-b079-d2c9427e2dfa",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Limpeza\n",
        "height": 260,
        "width": 1616,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -320,
        1376
      ],
      "typeVersion": 1,
      "id": "dd3e5ce6-7a6b-4267-89ee-95ba1d7f43d9",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DELETE FROM n8n_chat_histories",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -224,
        1456
      ],
      "id": "03c27b4f-e2d7-4e12-b33a-a6786c981a08",
      "name": "Deletar Histórico",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from chat_messages",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        800,
        1456
      ],
      "id": "01e1effd-8827-4935-ad1d-f668206becec",
      "name": "Deletar conteúdo Chat_Messages",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from dados_cliente",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        272,
        1456
      ],
      "id": "7c373d55-c3c8-4156-a2d5-8e06751402d1",
      "name": "Deletar conteúdo Dados Cliente",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from chats",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        32,
        1456
      ],
      "id": "fbf9bc82-b22a-4d4b-9891-e29e57e72f67",
      "name": "Deletar conteúdo Chats",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from documents",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        544,
        1456
      ],
      "id": "9aaadc7e-a21d-439f-b0ba-c0daae26e4fc",
      "name": "Deletar conteúdo Documentos",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d5a342e9-585b-42ea-be44-644adae10199",
              "leftValue": "={{ $('Mensagem').item.json.mensagem }}",
              "rightValue": "={{ $json.propertyName?.last() }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "22c78d64-bd4f-4136-abb4-4a0a03ce46e9",
      "name": "Compara Memoria",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        8224,
        384
      ]
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Whatsapp message to be splitted and formatted: {{ $('orquestrador').item.json.output }}",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "={\n  \"messages\": [\n    \"Você é um assistente que divide mensagens longas de WhatsApp em partes menores, mantendo tom natural e fluido.\",\n    \"CRÍTICO: Responda APENAS com JSON puro. Formato obrigatório: {\\\"messages\\\": [\\\"mensagem 1\\\", \\\"mensagem 2\\\"]}\",\n    \"NÃO use markdown, NÃO use ```json, NÃO adicione texto explicativo. SOMENTE o objeto JSON.\",\n    \"Use quebras de linha reais (\\\\n) dentro das strings. Nunca escape como \\\\\\\\n.\",\n    \"Cada mensagem: 250-350 caracteres. Não quebre frases no meio.\",\n    \"NÃO reescreva. NÃO expanda. NÃO adicione conteúdo. Apenas divida o texto original.\",\n    \"Máximo 4 mensagens. Prefira menos se possível.\",\n    \"NUNCA gere mensagens vazias.\",\n    \"Remova toda formatação: negrito, itálico, tachado.\",\n    \"Links https:// devem ficar entre crases: `https://exemplo.com`\",\n    \"NÃO adicione códigos, identificadores ou qualquer texto extra além das mensagens divididas.\",\n    \"A entrada virá assim: Whatsapp message to be splitted and formatted: [TEXTO]\"\n  ]\n}"
            }
          ]
        }
      },
      "id": "2ddcf8f7-ed70-4a00-bad5-96b321c0b110",
      "name": "Split de mensagens",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        11696,
        416
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "7a1830f8-fca5-4b10-b824-dce7b74b344d",
      "name": "OpenAI Split",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        11664,
        624
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "# INICIO\n\n",
        "height": 780,
        "width": 1040,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -176,
        64
      ],
      "typeVersion": 1,
      "id": "a2b40d9d-4e8c-4278-bf24-1ed35ff2239c",
      "name": "Sticky Note32"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "69a59373-8ee0-4d1b-bb60-2dc4b86df588",
      "name": "Edit Fields",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5872,
        448
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "239cab79-8fb1-45ca-9a04-11006892d52e",
              "name": "mensagem",
              "value": "={{ $json.content || $('Dados').item.json.message.content || $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7392,
        352
      ],
      "id": "2fb04853-a3c8-42af-8414-60266a8c1f5d",
      "name": "Mensagem"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2448,
        1328
      ],
      "id": "8e3608dd-7863-4861-b850-a13196be7760",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "dataType": "binary",
        "textSplittingMode": "custom",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1.1,
      "position": [
        2704,
        1328
      ],
      "id": "4289d36e-aae0-46aa-ada7-cfbd8fba5b86",
      "name": "Default Data Loader"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        2288,
        1120
      ],
      "id": "63ff7cca-3f26-459f-ae80-4944ce93744d",
      "name": "When clicking ‘Execute workflow’"
    },
    {
      "parameters": {
        "operation": "download",
        "fileId": {
          "__rl": true,
          "value": "1LxFdSAGsLFLJU-8nF6q3yg55FDACZj4S",
          "mode": "list",
          "cachedResultName": "info_pos_0611.csv",
          "cachedResultUrl": "https://drive.google.com/file/d/1LxFdSAGsLFLJU-8nF6q3yg55FDACZj4S/view?usp=drivesdk"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2480,
        1120
      ],
      "id": "dda4e7de-7bef-4c0b-a0db-c6493b14d55f",
      "name": "Download file",
      "credentials": {
        "googleDriveOAuth2Api": {
          "id": "6631e3XH0YrNrV8w",
          "name": "powerbieduit"
        }
      }
    },
    {
      "parameters": {
        "chunkSize": 417,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        2720,
        1488
      ],
      "id": "28f00a23-ad47-417f-8f6b-834dde54d7c8",
      "name": "Recursive Character Text Splitter"
    },
    {
      "parameters": {
        "content": "Converte Documentos em Vetorial \n",
        "height": 580,
        "width": 996
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2064,
        1040
      ],
      "id": "b3ab877e-43a1-4c93-bc6a-11af5a0c5356",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": {
          "__rl": true,
          "value": "documents_pos",
          "mode": "list",
          "cachedResultName": "documents_pos"
        },
        "embeddingBatchSize": 64,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1.3,
      "position": [
        2720,
        1104
      ],
      "id": "ab6df33b-8f15-4db6-aae4-03a160098e5b",
      "name": "Supabase Vector Store1",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.data._embedded.leads[0].status_id }}",
                    "rightValue": 89820300,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    },
                    "id": "81bf90a7-0a29-4229-9fb3-cc04be0bfca0"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "RECEPTIVO"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "a11dec04-2f57-42bf-a6fc-2add3efe8afd",
                    "leftValue": "={{ $json.data._embedded.leads[0].status_id }}",
                    "rightValue": 89820304,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "FOLLOW UP "
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "27bccebf-da1a-4af0-8f3f-5d1d362dd733",
                    "leftValue": "={{ $json.data._embedded.leads[0].status_id }}",
                    "rightValue": 53917599,
                    "operator": {
                      "type": "number",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "SALESBOT"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        3616,
        400
      ],
      "id": "1a381b09-f91c-46c7-a600-1caabe96bf6e",
      "name": "Switch1"
    },
    {
      "parameters": {
        "url": "https://admamoeduitcombr.kommo.com/api/v4/leads",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "with",
              "value": "source"
            },
            {
              "name": "query",
              "value": "={{ ' ' + $('Code').item.json.telefoneCorreto.replace('@s.whatsapp.net', '') }}"
            },
            {
              "name": "filter[statuses][0][pipeline_id]",
              "value": "11685120"
            },
            {
              "name": "filter[statuses][0][status_id]",
              "value": "89820300"
            },
            {
              "name": "filter[statuses][1][pipeline_id]",
              "value": "11685120"
            },
            {
              "name": "filter[statuses][1][status_id]",
              "value": "89820304"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "accept",
              "value": "application/json"
            },
            {
              "name": "authorization",
              "value": "Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsImp0aSI6ImExNmNlYWNkMzAxZjMyYjg4NzAzOGE0NjYwZDc4NGY4YTk3ZTFjMTNlNjRkMzU5ZjU4NTM1NWQzYWMwZDdkMDVjZTY2ZWExOWExMzUyOTM5In0.eyJhdWQiOiI3MGFhNjUzZS04NmI5LTQ4ZjgtOTZhNy1kMjc4YzJiMTA4ZWEiLCJqdGkiOiJhMTZjZWFjZDMwMWYzMmI4ODcwMzhhNDY2MGQ3ODRmOGE5N2UxYzEzZTY0ZDM1OWY1ODUzNTVkM2FjMGQ3ZDA1Y2U2NmVhMTlhMTM1MjkzOSIsImlhdCI6MTc1MzQ3NDQzMywibmJmIjoxNzUzNDc0NDMzLCJleHAiOjE3NjYwMTYwMDAsInN1YiI6IjgyNjE4MzciLCJncmFudF90eXBlIjoiIiwiYWNjb3VudF9pZCI6MzAyMTQ1NjgsImJhc2VfZG9tYWluIjoia29tbW8uY29tIiwidmVyc2lvbiI6Miwic2NvcGVzIjpbImNybSIsImZpbGVzIiwiZmlsZXNfZGVsZXRlIiwibm90aWZpY2F0aW9ucyIsInB1c2hfbm90aWZpY2F0aW9ucyJdLCJoYXNoX3V1aWQiOiI5Y2ZkNmQ3OC1lZWYxLTQ0NTYtOTBmZS01YWU2NjM0M2VmZDIiLCJhcGlfZG9tYWluIjoiYXBpLWcua29tbW8uY29tIn0.kpJh8NWnz6vXtx-4f4uZ0MpdT-pBBrIafhwZ9QhMbJOH1BwOOZDVqPTSEpUAshugFGtwASRSaOBkWmMy-OyUp-50ueFj7ZR9efcqLpLiMlHJCM64F1wSIU4gz6AjbNlvwJdml2LYBZI88ymqEycW_G058RW_6tt--Zm9D9JklAjh68ZV3hNl980hrlMm2iKPOwN-GpMvZqtrn3RR6rw9lgWX00nQiphSfMSJX7GkI2Xnq5Si3VHKFaFnI6tUwQTbfO6EjxTgtu2cu6do9hl-hAad1Bt9trgtAVQVTeiwxXE-Uqx3R3YDgtFKpaMl9sAX0QTPwbDFjGUk3oQ6dNLJLg"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        3136,
        400
      ],
      "id": "3355c2b9-f52e-43c9-ad29-acca22c81e01",
      "name": "HTTP Request",
      "retryOnFail": false
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f5c281d3-f206-42bd-a05a-02d2b2c427a0",
              "name": "=data",
              "value": "={{ $json.data }}",
              "type": "object"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        3328,
        400
      ],
      "id": "58c07f42-e9e2-46b1-921e-4e1dde98f4c1",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "jsCode": "let telefoneRaw;\nlet telefoneCorreto;\n\n// 1. Tenta pegar do formato processado (por ex. depois de um Set)\nif ($json.Telefone) {\n  telefoneRaw = $json.Telefone;\n  telefoneCorreto = telefoneRaw.endsWith('@lid') && $json.body?.data?.key?.senderPn\n    ? $json.body.data.key.senderPn\n    : telefoneRaw;\n}\n\n// 2. Tenta pegar do JSON bruto vindo direto do webhook\nelse if ($json.body?.data?.key?.remoteJid) {\n  telefoneRaw = $json.body.data.key.remoteJid;\n  telefoneCorreto = telefoneRaw.endsWith('@lid') && $json.body?.data?.key?.senderPn\n    ? $json.body.data.key.senderPn\n    : telefoneRaw;\n}\n\n// 3. Caso não encontre nada, define como null\nelse {\n  telefoneCorreto = null;\n}\n\nreturn [\n  {\n    json: {\n      telefoneCorreto\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        352,
        432
      ],
      "id": "6e510c74-aad1-4540-9a79-4520edf712c0",
      "name": "Code"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        11120,
        128
      ],
      "id": "c22955d4-4321-43d0-9167-4d0633871840",
      "name": "Merge"
    },
    {
      "parameters": {
        "content": "# KOMMO\n\n",
        "height": 780,
        "width": 1236,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        2976,
        64
      ],
      "typeVersion": 1,
      "id": "d735445a-c32e-4751-9a49-1d8422c8ee12",
      "name": "Sticky Note21"
    },
    {
      "parameters": {
        "amount": 15
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        2928,
        400
      ],
      "id": "aeeb12d4-c628-4931-b84e-5304103a9c59",
      "name": "Wait1",
      "webhookId": "9570c1d5-ac36-4517-8cfb-32ad769dfb8a"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        5888,
        272
      ],
      "id": "400e7a2e-bf02-4495-afd2-5036b573ce40",
      "name": "Merge2"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        5696,
        112
      ],
      "id": "ed287bc7-4b86-4304-a18b-91422e3ba8d9",
      "name": "Merge3"
    },
    {
      "parameters": {
        "resource": "notes",
        "operation": "createNotes",
        "notes": {
          "common": [
            {
              "entity_id": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}",
              "text": "={{ $json.output }} - {{ $execution.id }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-kommo.kommo",
      "typeVersion": 1,
      "position": [
        11200,
        432
      ],
      "id": "df75a852-d089-4656-a3ab-95b360a9556b",
      "name": "Create new notes",
      "credentials": {
        "kommoOAuth2Api": {
          "id": "nwQNgfBiNqLrzKlG",
          "name": "Kommo Comercial CSV"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Create a table to store your documents\ncreate table documents_precos (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1200,
        1056
      ],
      "id": "40c98457-87a3-467c-9262-59385bd291ed",
      "name": "documents_precos",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "delete from documents_precos",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1072,
        1456
      ],
      "id": "f6cfdc2a-5be1-4e4e-97b3-08d7e74e8d58",
      "name": "Deletar conteúdo documents_precos",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "CREATE FUNCTION match_documents_precos (\n  query_embedding vector(1536),\n  match_count int default null,\n  filter jsonb DEFAULT '{}'\n) \nRETURNS TABLE (\n  id bigint,\n  content text,\n  metadata jsonb,\n  similarity float\n)\nLANGUAGE plpgsql\nAS $$\n#variable_conflict use_column\nBEGIN\n  RETURN QUERY\n  SELECT\n    documents_precos.id,\n    documents_precos.content,\n    documents_precos.metadata,\n    1 - (documents_precos.embedding <=> query_embedding) as similarity\n  FROM documents_precos  -- ✅ CORRIGIDO: Agora busca na tabela certa\n  WHERE documents_precos.metadata @> filter\n  ORDER BY documents_precos.embedding <=> query_embedding\n  LIMIT match_count;\nEND;\n$$;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        960,
        1056
      ],
      "id": "b135fcc5-79d5-4ce1-b525-342a7e26af93",
      "name": "match_documents_precos",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "440327379171310",
        "recipientPhoneNumber": "={{ $('Dados').item.json.Telefone.replace('@s.whatsapp.net', '') }}",
        "textBody": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        12640,
        448
      ],
      "id": "e5ad1fd8-5bf3-4778-bd39-6b0e4f4e0d97",
      "name": "Send message",
      "webhookId": "97ad0e83-cc00-48c6-8948-06d3a14986f0",
      "credentials": {
        "whatsAppApi": {
          "id": "uKAVEc80et1CTr0c",
          "name": "WACA CSV Comercial"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- Create a table to store your documents\ncreate table rerank (\n  id bigserial primary key,\n  content text, -- corresponds to Document.pageContent\n  metadata jsonb, -- corresponds to Document.metadata\n  embedding vector(1536) -- 1536 works for OpenAI embeddings, change if needed\n);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1456,
        1056
      ],
      "id": "68d8e18a-8187-444a-807f-682a4257ef91",
      "name": "rerank",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DROP FUNCTION IF EXISTS rerank(vector, integer, jsonb);\n\nCREATE FUNCTION rerank(\n  query_embedding vector(1536),\n  match_count int DEFAULT NULL,\n  filter jsonb DEFAULT '{}'::jsonb\n)\nRETURNS TABLE (\n  id uuid,\n  content text,\n  metadata jsonb,\n  similarity double precision\n)\nLANGUAGE plpgsql\nSTABLE\nAS $$\nBEGIN\n  RETURN QUERY\n  SELECT\n    d.id,\n    d.content,\n    d.metadata,\n    1 - (d.embedding <=> query_embedding) AS similarity   -- cosine similarity\n  FROM documents_precos AS d\n  WHERE (filter IS NULL OR filter = '{}'::jsonb OR d.metadata @> filter)\n  ORDER BY d.embedding <=> query_embedding                 -- menor distância primeiro\n  LIMIT match_count;                                       -- NULL = sem limite\nEND;\n$$;\n",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        1664,
        1072
      ],
      "id": "4d5cf367-83ab-44dc-bda9-a295609dd3d6",
      "name": "match_rerank",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "289b3516-051b-4605-9478-38fecd86aa17",
              "leftValue": "={{ $json.id_lead }}",
              "rightValue": "",
              "operator": {
                "type": "number",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        9136,
        352
      ],
      "id": "f9c67ba5-d701-493c-a5b3-12ee0ad18577",
      "name": "If"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        3616,
        656
      ],
      "id": "21138c3c-27bd-4a07-b00c-6fcf18f1bf5d",
      "name": "No Operation, do nothing3"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "intercambio_bu",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "keyValue": "={{ '+'.concat($('Code').item.json.telefoneCorreto.replace('@s.whatsapp.net','')) }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        8848,
        352
      ],
      "id": "f81f0750-eb56-440b-bfde-1c508254a474",
      "name": "VERIFICA INTERCAMBIO",
      "alwaysOutputData": true,
      "credentials": {
        "supabaseApi": {
          "id": "iGh1fsnV8INZevlH",
          "name": "Supabase IA ANH/SUM"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        5632,
        704
      ],
      "id": "600048b3-8d4b-47a4-85ca-dcf177d57b3e",
      "name": "Merge9"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "942f92f3-349c-4cb2-9a0c-e94ce223017e",
              "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.conversation }}",
              "rightValue": "Quero mais informações",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            },
            {
              "id": "7f34371a-d6ca-4701-bddf-d992722b86ba",
              "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.conversation }}",
              "rightValue": "👨‍🎓 Quero mais informações",
              "operator": {
                "type": "string",
                "operation": "equals",
                "name": "filter.operator.equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        12592,
        144
      ],
      "id": "ddb74841-1a9e-43ea-bd89-e49fd68e1fad",
      "name": "If1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        12800,
        240
      ],
      "id": "125a1342-9c71-4bcd-a7cf-5d744ae93983",
      "name": "No Operation, do nothing5"
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "face-insta",
          "mode": "list",
          "cachedResultName": "face-insta"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id_lead": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}",
            "created_at": "={{ $now.setZone(\"America/Sao_Paulo\").toISO() }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "id_lead",
              "displayName": "id_lead",
              "required": true,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [
        12800,
        48
      ],
      "id": "746b1b21-d768-461a-8df4-bc43e6197201",
      "name": "Insert rows in a table",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "chame esse agente para procurar preços",
        "text": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "options": {
          "systemMessage": "# 💰 Agente Preços - Consulta de Valores\n\n## IDENTIDADE\nVocê é o Agente Preços, especialista em consultar preços de cursos da Cruzeiro do Sul Virtual.\n\n**Tom:** Profissional, objetivo e técnico.  \n**Ferramenta:** buscar_documentos3\n\n---\n\n## MISSÃO\nConsulte a base de dados e encaminhe **TODAS as informações encontradas** ao orquestrador, sem filtros ou resumos.\n\n**OBRIGATÓRIO:** Sempre envie os preços das três modalidades quando disponíveis:\n- **EAD (Educação a Distância)**\n- **Ao Vivo (Síncrono/Online)**\n- **Semipresencial**\n\nSe o curso não oferecer alguma(s) dessas modalidades, envie apenas as que estiverem disponíveis na base de dados.\n\n---\n\n## ⚠️ REGRAS CRÍTICAS\n\n### ❌ NUNCA:\n- Inventar ou aproximar preços\n- Responder sem consultar buscar_documentos3\n- Filtrar ou resumir informações\n- Omitir dados retornados pela ferramenta\n- **Omitir modalidades disponíveis (EAD, Ao Vivo, Semipresencial)**\n\n### ✅ SEMPRE:\n- Use buscar_documentos3 antes de responder\n- Repasse TODO o conteúdo retornado\n- **Envie preços de TODAS as modalidades disponíveis (EAD, Ao Vivo, Semipresencial)**\n- Execute buscas com 2-3 variações por termo\n- Informe \"sem_resultado\" caso nada seja encontrado\n\n---\n\n## OTIMIZAÇÃO DE BUSCA\n\n### 1. REALIZE BUSCAS MÚLTIPLAS\nPara cada consulta, busque usando 2-3 variações do termo. Exemplos:\n- **RH:** \"RH\", \"recursos humanos\", \"gestão recursos humanos\"\n- **Marketing:** \"marketing\", \"gestão marketing\"\n- **Logística:** \"logística\", \"gestão logística\"\n- **Administração:** \"administração\", \"gestão empresarial\"\n\n### MAPEAMENTO COMUM\n\n| Termo | → Variações |\n|-------|-------------|\n| RH | \"recursos humanos\", \"gestão pessoas\" |\n| Vendas | \"comercial\", \"gestão comercial\" |\n| TI | \"tecnologia\", \"sistemas\", \"gestão tecnologia\" |\n| Financeiro | \"finanças\", \"gestão financeira\" |\n| Saúde Pública | \"gestão saúde\", \"saúde coletiva\" |\n| Ed. Física | \"esportes\", \"gestão esportiva\" |\n\n---\n\n## FLUXO DE EXECUÇÃO\n\n1. Receba a solicitação do orquestrador\n2. Execute buscar_documentos3 (com 2-3 variações)\n3. Aguarde o retorno completo\n4. **Identifique TODAS as modalidades disponíveis (EAD, Ao Vivo, Semipresencial)**\n5. Envie todos os dados obtidos OU \"sem_resultado\"\n\n---\n\n## TEMPLATES DE RESPOSTA\n\n### ✅ DADOS ENCONTRADOS\n\n```xml\n<resultado_encontrado>\n  <status>ENCONTRADO</status>\n  <modalidades_disponiveis>\n    <ead>\n      [PREÇOS E INFORMAÇÕES DA MODALIDADE EAD SE DISPONÍVEL]\n    </ead>\n    <ao_vivo>\n      [PREÇOS E INFORMAÇÕES DA MODALIDADE AO VIVO SE DISPONÍVEL]\n    </ao_vivo>\n    <semipresencial>\n      [PREÇOS E INFORMAÇÕES DA MODALIDADE SEMIPRESENCIAL SE DISPONÍVEL]\n    </semipresencial>\n  </modalidades_disponiveis>\n  <dados_completos>\n    [COLE AQUI TODO O CONTEÚDO RETORNADO PELA FERRAMENTA buscar_documentos3]\n  </dados_completos>\n  <buscas_realizadas>\n    - Termo 1: [termo]\n    - Termo 2: [termo]\n    - Termo 3: [termo]\n  </buscas_realizadas>\n</resultado_encontrado>\n```\n\n### ❌ NADA ENCONTRADO\n\n```xml\n<resultado_nao_encontrado>\n  <status>sem_resultado</status>\n  <buscas_realizadas>\n    - Termo 1: [termo]\n    - Termo 2: [termo]\n    - Termo 3: [termo]\n  </buscas_realizadas>\n  <mensagem>Nenhuma informação encontrada após múltiplas tentativas.</mensagem>\n</resultado_nao_encontrado>\n```\n\n---\n\n## REGRAS ESPECÍFICAS\n\n### Modalidades obrigatórias:\n- **Licenciaturas:** APENAS Semipresencial\n- **Cursos da Saúde:** APENAS Semipresencial\n- **Engenharias:** APENAS Semipresencial\n- **Pós-graduação:** Taxa de matrícula R$ 99,00\n\n### CURSOS TÉCNICOS\n\n```xml\n<curso_tecnico>\n  <status>sem_resultado</status>\n  <mensagem>Não oferecemos cursos técnicos. Apenas graduação e pós-graduação.</mensagem>\n</curso_tecnico>\n```\n\n---\n\n## CHECKLIST PRÉ-RESPOSTA\n\n- [ ] Executei 2-3 buscas com variações?\n- [ ] Repassei TODO o conteúdo da ferramenta?\n- [ ] **Identifiquei e enviei TODAS as modalidades disponíveis (EAD, Ao Vivo, Semipresencial)?**\n- [ ] Usei \"sem_resultado\" se nada foi encontrado?\n- [ ] Não filtrei nem resumi informações?\n- [ ] Não inventei dados?\n\n---\n\n## RESUMO EXECUTIVO\n\n🏆 **FUNÇÃO:** Buscar e repassar informações de preços de TODAS as modalidades  \n🔧 **FERRAMENTA:** buscar_documentos3  \n📋 **OUTPUT:** Dados completos de EAD, Ao Vivo e Semipresencial (quando disponíveis) OU \"sem_resultado\"  \n⚡ **AÇÃO:** Múltiplas buscas + repasse integral + todas as modalidades\n\n---\n\n**Você é a ponte entre a base de dados e o orquestrador. Repasse tudo. Não filtre nada. Sempre inclua as três modalidades quando disponíveis.**"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        9472,
        -304
      ],
      "id": "943a481b-dd91-448b-a7b8-335ed81cf4bf",
      "name": "agente preços"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "options": {
          "systemMessage": "=# 🎯 Orquestrador - Universidade Cruzeiro do Sul\n\n## IDENTIDADE\nVocê é o **Orquestrador**, assistente da **Universidade Cruzeiro do Sul**.\n**Tom:** Natural, acolhedor, conversacional - como um consultor humano.\n**Contexto:** Você atende leads que estão entrando em contato.\n\n---\n\n## 🎬 PRIMEIRA MENSAGEM\n\n**Na PRIMEIRA interação do lead:**\n\n**Se a primeira mensagem for uma saudação simples (oi, olá, etc.):**\n```\n\"Olá! Sou o assistente da Universidade Cruzeiro do Sul. 😊\n\nEstou aqui para te ajudar! Em que posso te auxiliar hoje?\"\n```\n\n**Se a primeira mensagem for uma pergunta:**\n```\nResponda diretamente a pergunta (executando a tool necessária se aplicável)\n```\n\n**⚠️ IMPORTANTE:** Envie saudação APENAS quando a primeira mensagem for uma saudação simples. Se for uma pergunta, responda diretamente. Depois da primeira interação, nunca mais envie saudações.\n\n---\n\n## ⚙️ FERRAMENTAS (4 TOOLS)\n\n### 🔧 `receptivo_informacoes`\n**Usar quando:** Perguntas sobre curso (duração, grade, modalidade, etc.)\n**⚠️ OBRIGATÓRIO:** SEMPRE executar esta tool para QUALQUER pergunta relacionada a cursos. NUNCA responda sobre cursos sem executar a tool.\n\n### 🔧 `agente_precos`\n**Usar quando:** Perguntas sobre valores, mensalidades, formas de pagamento\n**⚠️ OBRIGATÓRIO:** SEMPRE executar esta tool para QUALQUER pergunta relacionada a preços. NUNCA responda sobre preços sem executar a tool.\n\n### 🔧 `distribuir_humano`\n**Usar quando:**\n- Lead pede para falar com humano\n- `receptivo_informacoes` retorna SEM_RESULTADO e NÃO há cursos similares para recomendar\n- **Pergunta sobre qualquer assunto que NÃO seja curso ou preço e você não sabe responder**\n- Dúvidas sobre processo, documentação, matrícula que você não consegue responder\n- **Quando NÃO entender o que o lead quis dizer (mensagem confusa/incompreensível)**\n\n### 🔧 `inscricao`\n**Usar quando:** Lead confirma que quer se matricular/inscrever (APENAS confirmação final)\n\n---\n\n## 🚨 REGRAS CRÍTICAS\n\n```\n✅ SEMPRE responda em LINGUAGEM NATURAL (NUNCA JSON)\n✅ Saudação APENAS na PRIMEIRA mensagem E SOMENTE se for saudação simples (se for pergunta, responda direto)\n✅ Curso mencionado → SEMPRE EXECUTAR receptivo_informacoes (OBRIGATÓRIO)\n✅ Preço mencionado → SEMPRE EXECUTAR agente_precos (OBRIGATÓRIO)\n✅ \"Quero falar com atendente\" → EXECUTAR distribuir_humano\n✅ \"Quero me matricular\" (decisão final) → EXECUTAR inscricao\n✅ **Pergunta sobre assunto que você NÃO sabe responder → EXECUTAR distribuir_humano**\n✅ **NÃO entendeu o que o lead quis dizer → EXECUTAR distribuir_humano**\n\n❌ NUNCA mencione outras universidades\n❌ NUNCA forneça contatos (telefone/email/WhatsApp)\n❌ NUNCA invente informações\n❌ NUNCA mencione ou fale sobre cursos 100% EAD\n❌ NUNCA envie saudações após a primeira mensagem\n❌ NUNCA responda sobre cursos sem executar receptivo_informacoes\n❌ NUNCA responda sobre preços sem executar agente_precos\n```\n\n---\n\n## 🔒 REGRA DE OURO - EXECUÇÃO OBRIGATÓRIA DE TOOLS\n\n### 🎓 CURSOS\n```\nQUALQUER menção a curso → EXECUTAR receptivo_informacoes IMEDIATAMENTE\nExemplos:\n- \"quanto tempo dura ADM\" → receptivo_informacoes\n- \"tem curso de enfermagem?\" → receptivo_informacoes\n- \"me fala sobre engenharia\" → receptivo_informacoes\n- \"quais as matérias de direito\" → receptivo_informacoes\n- \"qual a grade do curso\" → receptivo_informacoes\n- \"tem aula presencial\" → receptivo_informacoes\n\n⚠️ PROIBIDO: Mencionar cursos 100% EAD ou inventar informações sobre modalidades\n```\n\n### 💰 PREÇOS\n```\nQUALQUER menção a valor/preço → EXECUTAR agente_precos IMEDIATAMENTE\nExemplos:\n- \"quanto custa\" → agente_precos\n- \"qual o valor\" → agente_precos\n- \"mensalidade\" → agente_precos\n- \"tem desconto\" → agente_precos\n- \"formas de pagamento\" → agente_precos\n- \"preço\" → agente_precos\n```\n\n**⚠️ PROIBIDO:** Responder sobre cursos ou preços com seu conhecimento próprio. SEMPRE execute a tool correspondente.\n\n---\n\n## 🔄 FLUXO DE DECISÃO\n\n```\nMENSAGEM RECEBIDA\n     ↓\nÉ a primeira mensagem?\n  → Saudação simples? → Enviar saudação inicial\n  → Pergunta? → Responder diretamente (executar tool se necessário)\n     ↓\nNÃO entendeu a mensagem? → distribuir_humano\n     ↓\nPede falar com humano? → distribuir_humano\n     ↓\nConfirma matrícula final? → inscricao\n     ↓\nMenciona PREÇO? → EXECUTAR agente_precos (OBRIGATÓRIO)\n     ↓\nMenciona CURSO? → EXECUTAR receptivo_informacoes (OBRIGATÓRIO)\n     ↓\nPergunta sobre OUTRO ASSUNTO (processo, docs, etc.)? → Tenta responder\n     ↓\nNÃO consegue responder? → distribuir_humano\n```\n\n---\n\n## 🔧 TRATAMENTO DE RESPOSTAS\n\n### `receptivo_informacoes` retorna ENCONTRADO:\n```\nApresentar info naturalmente + CTA\n⚠️ NUNCA mencione cursos 100% EAD\n```\n\n### `receptivo_informacoes` retorna SEM_RESULTADO COM sugestões:\n```\n\"Não encontrei esse curso, mas temos:\n1. [Curso A]\n2. [Curso B]\n3. [Curso C]\n\nAlgum te interessa?\"\n```\n\n### `receptivo_informacoes` retorna SEM_RESULTADO SEM sugestões:\n```\nEXECUTAR distribuir_humano\n```\n\n### `agente_precos` retorna ENCONTRADO:\n```\nApresentar valores naturalmente + CTA\n```\n\n### `agente_precos` retorna SEM_RESULTADO:\n```\n\"Para valores específicos, vou conectar você com o atendimento!\nEnquanto isso, quer saber sobre o curso?\"\n```\n\n---\n\n## 📋 EXEMPLOS RÁPIDOS\n\n### Ex 1: Primeira mensagem - saudação simples\n**IN:** \"oi\"\n**OUT:** \"Olá! Sou o assistente da Universidade Cruzeiro do Sul. 😊 Estou aqui para te ajudar! Em que posso te auxiliar hoje?\"\n\n### Ex 1b: Primeira mensagem - pergunta\n**IN:** \"quanto tempo dura ADM\"\n**AÇÃO:** `receptivo_informacoes(\"quanto tempo dura ADM\")` ← OBRIGATÓRIO\n**OUT:** \"O curso de Administração tem [duração]! [info natural]. Quer saber mais?\"\n\n### Ex 2: Pergunta sobre curso\n**IN:** \"quanto tempo dura ADM\"\n**AÇÃO:** `receptivo_informacoes(\"quanto tempo dura ADM\")` ← OBRIGATÓRIO\n**OUT:** \"O curso de Administração tem [duração]! [info natural]. Quer saber mais?\"\n\n### Ex 3: Pergunta sobre preço\n**IN:** \"e o preço\"\n**AÇÃO:** `agente_precos(\"preço administração\")` ← OBRIGATÓRIO\n**OUT:** \"Os valores são: [apresentar naturalmente]. Alguma dúvida?\"\n\n### Ex 4: Pergunta genérica sobre curso\n**IN:** \"vocês tem curso de medicina?\"\n**AÇÃO:** `receptivo_informacoes(\"curso de medicina\")` ← OBRIGATÓRIO\n**NUNCA:** Responder \"sim/não\" sem executar a tool\n\n### Ex 5: Pergunta sobre valor\n**IN:** \"a mensalidade é cara?\"\n**AÇÃO:** `agente_precos(\"mensalidade\")` ← OBRIGATÓRIO\n**NUNCA:** Responder sem consultar a tool\n\n### Ex 6: Pedir humano\n**IN:** \"quero falar com atendente\"\n**AÇÃO:** `distribuir_humano()`\n\n### Ex 7: Confirmar matrícula\n**IN:** \"quero me matricular\"\n**AÇÃO:** `inscricao()`\n\n### Ex 8: Pergunta que não sabe responder\n**IN:** \"como funciona o reconhecimento de diploma estrangeiro?\"\n**ANÁLISE:** Pergunta específica fora do escopo (não é curso nem preço)\n**AÇÃO:** `distribuir_humano()`\n**OUT:** \"Vou conectar você com um especialista que pode te ajudar com essa questão específica!\"\n\n### Ex 9: Dúvida sobre processo complexo\n**IN:** \"preciso de quais documentos para transferência externa?\"\n**ANÁLISE:** Dúvida específica sobre processo que você não domina\n**AÇÃO:** `distribuir_humano()`\n**OUT:** \"Para te dar as informações corretas sobre documentação, vou te conectar com nosso atendimento especializado!\"\n\n### Ex 10: Mensagem incompreensível\n**IN:** \"asjkdh curso asdjh 123\"\n**ANÁLISE:** Não conseguiu entender o que o lead quis dizer\n**AÇÃO:** `distribuir_humano()`\n**OUT:** \"Desculpe, não consegui entender sua mensagem. Vou te conectar com um atendente que pode te ajudar melhor!\"\n\n---\n\n## ✅ CHECKLIST PRÉ-RESPOSTA\n\n- [ ] É a primeira mensagem? Se saudação simples, enviei saudação. Se pergunta, respondi direto.\n- [ ] NÃO enviei saudação em mensagens subsequentes?\n- [ ] Menção a CURSO? Se sim, EXECUTEI receptivo_informacoes? (OBRIGATÓRIO)\n- [ ] Menção a PREÇO? Se sim, EXECUTEI agente_precos? (OBRIGATÓRIO)\n- [ ] NÃO mencionei cursos 100% EAD?\n- [ ] NÃO inventei informações?\n- [ ] Resposta em linguagem NATURAL (não JSON)?\n- [ ] Executei tool correta se necessário?\n- [ ] Tom acolhedor e conversacional?\n- [ ] Máx 2 emojis?\n- [ ] Terminei com CTA?\n\n---\n\n## 🎯 RESUMO\n\n```\n🤖 VOCÊ: Orquestrador - Universidade Cruzeiro do Sul\n📋 FORMATO: Sempre linguagem natural\n🔧 4 TOOLS: receptivo_informacoes, agente_precos, distribuir_humano, inscricao\n⚡ REGRA DE OURO: \n   - CURSO = SEMPRE executar receptivo_informacoes (NUNCA responda sozinho)\n   - PREÇO = SEMPRE executar agente_precos (NUNCA responda sozinho)\n   - HUMANO = distribuir_humano\n   - NÃO ENTENDEU = distribuir_humano\n👋 SAUDAÇÃO: Apenas na PRIMEIRA mensagem E SOMENTE se for saudação simples\n🚫 PROIBIDO: \n   - Responder sobre cursos/preços sem executar a tool correspondente\n   - Mencionar cursos 100% EAD\n   - Inventar informações\n```\n\n**Seja natural e acolhedor como um consultor humano! Mas SEMPRE execute as tools para cursos e preços!** ✨"
        }
      },
      "id": "33b8ada0-2ca4-4530-a7a6-fa5869e11216",
      "name": "orquestrador",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        9616,
        -608
      ]
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        9504,
        48
      ],
      "id": "67918d65-084b-4f79-a504-f71cd6e52d68",
      "name": "Calculator"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        10464,
        112
      ],
      "id": "88916fab-40b9-4573-87c0-84192a2fd89e",
      "name": "Think"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        9792,
        -160
      ],
      "id": "fb0708b5-1bec-4574-91fa-25702b5101dd",
      "name": "reflexao"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {
          "maxTokens": 600,
          "temperature": 0,
          "topP": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        9392,
        -32
      ],
      "id": "ae40995a-bbf6-4ba0-8436-f244e22a2046",
      "name": "OpenAI Chat Model2",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {
          "maxTokens": 1200,
          "temperature": 0.4,
          "topP": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        10000,
        208
      ],
      "id": "cc447526-f61c-459e-86f8-eb3cd9bafd03",
      "name": "OpenAI Chat Model3",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        9424,
        112
      ],
      "id": "462c96d8-14f1-4492-b46c-c63b5c59b3f2",
      "name": "Postgres Chat Memory1",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "contextWindowLength": 15
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        10160,
        160
      ],
      "id": "80c8ec31-f990-4703-b9ab-fc6a8cac0662",
      "name": "Postgres Chat Memory2",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "description": "use essa tool para enviar o template de inscricao do whatsapp ",
        "workflowId": {
          "__rl": true,
          "value": "FgPYiDXMl6Ita0We",
          "mode": "list",
          "cachedResultUrl": "/workflow/FgPYiDXMl6Ita0We",
          "cachedResultName": "distribuicao_ai_flows"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "telefone": "={{ $('Code').item.json.telefoneCorreto }}"
          },
          "matchingColumns": [
            "telefone"
          ],
          "schema": [
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        9936,
        -128
      ],
      "id": "5cf3bb63-07bd-4373-8e53-26ec022a938b",
      "name": "inscricao"
    },
    {
      "parameters": {
        "description": "⚠️ SÓ USAR SE RAG = \"distribuir_humano\" ou \"RAG_SEM_RESULTADO:\"\n❌ NUNCA USAR SE RAG TEM DADOS DE CURSO (📘🎓💰)\nQuando tem dados = VENDER, não distribuir!",
        "workflowId": {
          "__rl": true,
          "value": "pWLVh6dNNqX0DfAl",
          "mode": "list",
          "cachedResultUrl": "/workflow/pWLVh6dNNqX0DfAl",
          "cachedResultName": "distribuir_atendimento_ia csv"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "telefone": "={{ $('Code').item.json.telefoneCorreto }}",
            "id_lead": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}"
          },
          "matchingColumns": [
            "Telefone"
          ],
          "schema": [
            {
              "id": "id_lead",
              "displayName": "id_lead",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        10032,
        -112
      ],
      "id": "d530b836-d5d5-4de1-acb7-6b768325a26c",
      "name": "distribuir_humano"
    },
    {
      "parameters": {
        "jsCode": "// Pega todos os items do node \"Edit Fields1\"\nconst items = $items(\"Edit Fields1\");\n\n// mapeia cada item\nreturn items.map(item => {\n    const leads = item.json?.data?._embedded?.leads || [];\n    if (leads.length === 0) {\n        return { json: { curso: \"Não encontrado\" } };\n    }\n\n    const lead = leads[0]; // pega o primeiro lead, ajusta se quiser todos\n    const customFields = lead.custom_fields_values || [];\n    const cursoField = customFields.find(f => f.field_name === \"Curso\");\n    const cursoValue = cursoField?.values?.[0]?.value || \"Não informado\";\n\n    return {\n        json: {\n            curso: cursoValue\n        }\n    };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        8816,
        1312
      ],
      "id": "816cc285-81ed-4eb6-b28d-ee302f1e8ed6",
      "name": "Code2"
    },
    {
      "parameters": {
        "content": "# Enfileirar Mensagens\n",
        "height": 780,
        "width": 1772,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        6896,
        896
      ],
      "typeVersion": 1,
      "id": "15d1a072-3ee1-4cf9-8a10-509a914421ef",
      "name": "Sticky Note19"
    },
    {
      "parameters": {
        "content": "# BUFFERING\n",
        "height": 796,
        "width": 2644,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        4256,
        880
      ],
      "typeVersion": 1,
      "id": "9dd9c929-f52a-40b0-81ae-f5c3ba7e281a",
      "name": "Sticky Note22"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "db546aee-9112-4db5-b963-eefe8a9e5eec",
      "name": "Edit Fields4",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        5504,
        1472
      ]
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "Analise essa imagem e resuma pra mim o que ela é",
        "inputType": "base64",
        "options": {}
      },
      "id": "7da74512-8f7f-4a78-83be-e10ab82d356f",
      "name": "OpenAI",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        6208,
        1472
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "4d9808ff-85b9-47cf-871a-8fbaab287067",
      "name": "OpenAI5",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.6,
      "position": [
        6800,
        1248
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.ogg",
          "mimeType": "application/ogg"
        }
      },
      "id": "77b926e1-240d-443d-8b24-ab3abe3d3882",
      "name": "Converter Audio1",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        6592,
        1280
      ]
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {
          "fileName": "file.png",
          "mimeType": "image/png"
        }
      },
      "id": "655f15f7-e299-4371-9f3d-26b2953a50ea",
      "name": "Converter Foto1",
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        5840,
        1472
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "52aaf749-fe4f-44e4-880e-15b2bfc027f1",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "extendedTextMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "e514e613-fd6a-48bd-b0ae-bae2448c810e",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "conversation",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "text"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "audioMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "audio"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "c0e434dd-1268-421d-b81b-3a5e90ed9550",
                    "leftValue": "={{ $('Webhook EVO').item.json.body.data.messageType }}",
                    "rightValue": "imageMessage",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            }
          ]
        },
        "options": {}
      },
      "id": "382fc605-a52d-4c03-a83a-0b72a6bce813",
      "name": "ROTA Mensagens1",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        4736,
        1168
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.noOp",
      "typeVersion": 1,
      "position": [
        8320,
        1488
      ],
      "id": "aec9ba46-6833-47f2-9730-a6579d82ac5f",
      "name": "No Operation, do nothing4"
    },
    {
      "parameters": {
        "amount": 15
      },
      "id": "60f80560-d99d-4663-877e-c5e3bd414399",
      "name": "Intervalo entre Mensagens1",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        7712,
        1328
      ],
      "webhookId": "173b6f50-2e8b-43b2-af16-3741780b23af"
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Code').item.json.telefoneCorreto }}",
        "messageData": "={{ $('Dados').item.json.message.content }}",
        "tail": true
      },
      "id": "486fc1d7-2e26-4745-9d93-ea48190a2b88",
      "name": "Texto Redis1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        5920,
        1040
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $json.text }}",
        "tail": true
      },
      "id": "74c7ce86-b129-4675-b619-e48b64ad63a4",
      "name": "Audio Redis1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        7072,
        1232
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "a910c7f9-506f-42fc-8362-c89ffd8017cb",
      "name": "imagem Redis1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        6912,
        1408
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "={{ $('Dados').item.json.Telefone }}",
        "messageData": "={{ $('Dados').item.json.message.content }}, {{ $json.content.replace(/\\n/g, \"\\\\n\").replace(/['\"]/g, '').trim()  }}",
        "tail": true
      },
      "id": "38c9f97f-713c-4a23-8203-794eeaa00ddb",
      "name": "Imagem Redis1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        6912,
        1536
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "key": "={{ $('Code').item.json.telefoneCorreto }}",
        "options": {}
      },
      "id": "0ab30702-6043-4114-aebf-8312125f3249",
      "name": "Buscas Mensagens1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        7904,
        1328
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "239cab79-8fb1-45ca-9a04-11006892d52e",
              "name": "mensagem_completa",
              "value": "={{ $json.propertyName }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        8320,
        1312
      ],
      "id": "6aba4bff-c4e0-4125-b0c1-4a20fff2bade",
      "name": "Mensagem Completa"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Code').item.json.telefoneCorreto }}"
      },
      "id": "54a55e77-6d4e-4169-afe7-1311ad0ab7b5",
      "name": "Deletar Mensagens1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        8608,
        1312
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "d5a342e9-585b-42ea-be44-644adae10199",
              "leftValue": "={{ $('Mensagem1').item.json.mensagem }}",
              "rightValue": "={{ $json.propertyName?.last() }}",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "2e07e68b-5dd9-4d88-bb30-b68c4c9f2e69",
      "name": "Compara Memoria1",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        8096,
        1328
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "3c5ccbc9-69d1-4b13-a7c3-e6945bc8c655",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "60094283-b5c1-4171-a2b3-268e4b561ee5",
      "name": "Edit Fields5",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        6336,
        1280
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "239cab79-8fb1-45ca-9a04-11006892d52e",
              "name": "mensagem",
              "value": "={{ $json.content || $('Dados').item.json.message.content || $json.text }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        7520,
        1328
      ],
      "id": "04d07a17-9665-4386-9992-28b23cabfe81",
      "name": "Mensagem1"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        5504,
        1120
      ],
      "id": "a7cad5bf-9b65-4e11-b0ea-e0da27893874",
      "name": "Merge4"
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        5504,
        944
      ],
      "id": "beca2be0-3d91-475e-9427-af773bc44e90",
      "name": "Merge5"
    },
    {
      "parameters": {
        "operation": "toBinary",
        "sourceProperty": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.convertToFile",
      "typeVersion": 1.1,
      "position": [
        5488,
        1296
      ],
      "id": "b6b45bf6-b848-4c29-bc09-acd3fe23a33a",
      "name": "Convert to File"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "bf2f01bb-bee7-4238-becf-b3afbb17b07a",
              "name": "data",
              "value": "={{ $('Webhook EVO').item.json.body.data.message.base64 }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        4944,
        1264
      ],
      "id": "a27dbd7d-3711-4134-a796-b45682ea4e71",
      "name": "Edit Fields6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 1
          },
          "conditions": [
            {
              "id": "ade56c50-1520-4760-8df5-e99617d6d3ad",
              "leftValue": "={{ $('Webhook EVO').item.json.body.data.message.imageMessage.caption }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "d2c6a14d-f1fa-4314-84f7-05498c71efba",
      "name": "If2",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        6560,
        1472
      ]
    },
    {
      "parameters": {
        "content": "# Agente Principal\n",
        "height": 1660,
        "width": 1924,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        8688,
        -752
      ],
      "typeVersion": 1,
      "id": "d92a15d3-7bc5-44bd-a09a-045834559fc8",
      "name": "Sticky Note23"
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {
          "frequencyPenalty": 0.2,
          "maxTokens": 1000,
          "responseFormat": "text",
          "presencePenalty": 0.1,
          "temperature": 0.4,
          "topP": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        9776,
        1104
      ],
      "id": "01bef887-49b8-4fd3-abd3-2407692f2a62",
      "name": "OpenAI Chat Model5",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        9952,
        1184
      ],
      "id": "c63e01e2-831d-42fb-bace-7bbc3706aff4",
      "name": "Postgres Chat Memory5",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "description": "use essa tool para enviar o template de inscricao do whatsapp ",
        "workflowId": {
          "__rl": true,
          "value": "FgPYiDXMl6Ita0We",
          "mode": "list",
          "cachedResultUrl": "/workflow/FgPYiDXMl6Ita0We",
          "cachedResultName": "distribuicao_ai_flows"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "telefone": "={{ $('Code').item.json.telefoneCorreto }}"
          },
          "matchingColumns": [
            "telefone"
          ],
          "schema": [
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        10192,
        1312
      ],
      "id": "d96898f3-9344-4e31-8e25-8aa652bd882d",
      "name": "inscricao1"
    },
    {
      "parameters": {
        "description": "⚠️ SÓ USAR SE RAG = \"distribuir_humano\" ou \"RAG_SEM_RESULTADO:\"\n❌ NUNCA USAR SE RAG TEM DADOS DE CURSO (📘🎓💰)\nQuando tem dados = VENDER, não distribuir!",
        "workflowId": {
          "__rl": true,
          "value": "pWLVh6dNNqX0DfAl",
          "mode": "list",
          "cachedResultUrl": "/workflow/pWLVh6dNNqX0DfAl",
          "cachedResultName": "distribuir_atendimento_ia csv"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "telefone": "={{ $('Code').item.json.telefoneCorreto }}",
            "id_lead": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}"
          },
          "matchingColumns": [
            "Telefone"
          ],
          "schema": [
            {
              "id": "id_lead",
              "displayName": "id_lead",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            },
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        10304,
        1280
      ],
      "id": "c5e82e02-2ec1-44f9-b6a9-60e9c813b19a",
      "name": "distribuir_humano1"
    },
    {
      "parameters": {
        "jsCode": "// Code node (JS) — \"Run Once for All Items\"\nconst seen = new Map();\n\nfor (const item of items) {\n  const key = item.json.id_lead;\n  const prev = seen.get(key);\n\n  // Mantém o de maior \"id\"\n  if (!prev || Number(item.json.id ?? -Infinity) > Number(prev.json.id ?? -Infinity)) {\n    seen.set(key, item);\n  }\n}\n\n// Retorna no formato correto do n8n\nreturn Array.from(seen.values());\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        8960,
        992
      ],
      "id": "87dc64fe-895e-4b89-879d-875f3cae9e28",
      "name": "Code1"
    },
    {
      "parameters": {
        "resource": "leads",
        "operation": "updateLeads",
        "collection": {
          "lead": [
            {
              "id": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}",
              "pipeline_id": 11685120,
              "status_id": 89820304
            }
          ]
        }
      },
      "type": "n8n-nodes-kommo.kommo",
      "typeVersion": 1,
      "position": [
        9120,
        992
      ],
      "id": "c67ce46d-4e13-42fd-81e2-ab1d59728599",
      "name": "Update leads",
      "credentials": {
        "kommoOAuth2Api": {
          "id": "nwQNgfBiNqLrzKlG",
          "name": "Kommo Comercial CSV"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "c4346f8f-a6fc-45ac-8da3-07d0eb348816",
      "name": "Loop Over Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        12752,
        1584
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3,
      "position": [
        12784,
        1264
      ],
      "id": "742e4e9a-11e7-4452-92de-0953a7025484",
      "name": "Merge6"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "defac08a-6745-422b-bb05-90da9f47d91b",
              "leftValue": "={{ $('Busca Telefone1').last().json.values() }}",
              "rightValue": "",
              "operator": {
                "type": "array",
                "operation": "empty",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        12288,
        1248
      ],
      "id": "837e6284-8750-4cbc-bd45-1c825592be84",
      "name": "If5"
    },
    {
      "parameters": {
        "content": "# Histórico Supabase\n",
        "height": 380,
        "width": 1740,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        11504,
        1040
      ],
      "typeVersion": 1,
      "id": "961c8065-7e7c-48e7-b45e-f33785060f4a",
      "name": "Sticky Note55"
    },
    {
      "parameters": {
        "operation": "get",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "keyValue": "={{ $('Code').item.json.telefoneCorreto }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        12128,
        1248
      ],
      "id": "ac76ddf6-4678-4ddc-a1a8-1b635b8cc240",
      "name": "Busca Telefone1",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      },
      "disabled": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "tableId": "chats",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Code').item.json.telefoneCorreto }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        12528,
        1152
      ],
      "id": "728b92c6-ef61-435d-86c9-1f468c308e52",
      "name": "Adiciona CHAT supabase1",
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "chats",
        "filters": {
          "conditions": [
            {
              "keyName": "phone",
              "condition": "eq",
              "keyValue": "={{ $('Code').item.json.telefoneCorreto }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "updated_at",
              "fieldValue": "={{ $now}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        12528,
        1328
      ],
      "id": "443f984c-3d3b-44a3-860e-d21d6c7e261c",
      "name": "Atualiza CHAT Supabase1",
      "alwaysOutputData": true,
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "tableId": "chat_messages",
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "phone",
              "fieldValue": "={{ $('Code').item.json.telefoneCorreto }}"
            },
            {
              "fieldId": "bot_message",
              "fieldValue": "={{ $('Fupper').first().json.output }}"
            },
            {
              "fieldId": "user_message",
              "fieldValue": "={{ $('Dados').first().json.message.content }}"
            },
            {
              "fieldId": "message_type",
              "fieldValue": "={{ $('Dados').first().json.body.event }}"
            },
            {
              "fieldId": "created_at",
              "fieldValue": "={{ $now }}"
            },
            {
              "fieldId": "nomewpp",
              "fieldValue": "={{ $('Dados').first().json.NomeWpp }}"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        12992,
        1264
      ],
      "id": "dbff5cee-415b-45e2-aa36-ed192022e994",
      "name": "Cria Histórico Supabase1",
      "retryOnFail": true,
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "fieldToSplitOut": "output.messages",
        "options": {
          "destinationFieldName": "output"
        }
      },
      "id": "4f81b3f3-431d-4416-91a5-7d3baed6f251",
      "name": "Split de Mensagem1",
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        12496,
        1584
      ]
    },
    {
      "parameters": {
        "amount": 1
      },
      "id": "a89df470-32dd-44fc-af8d-1518b0251b6f",
      "name": "1 segundo1",
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        13264,
        1600
      ],
      "webhookId": "656d4433-3777-4ec4-b434-5ac72f1987cd"
    },
    {
      "parameters": {
        "operation": "delete",
        "key": "={{ $('Dados').first().json.Telefone }}"
      },
      "id": "8ea943d1-b6c9-4cad-9108-ca8780ccb363",
      "name": "Delete Memory1",
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        13184,
        1264
      ],
      "credentials": {
        "redis": {
          "id": "YZXVKYORNr25luYM",
          "name": "Redis - AI"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Whatsapp message to be splitted and formatted: {{ $('Fupper').item.json.output }}\n",
        "hasOutputParser": true,
        "messages": {
          "messageValues": [
            {
              "message": "=System: # 📝 Agente Resumidor de Conversas IA\n### Especialista em Síntese Precisa de Atendimentos\n\n---\n\n## 1️⃣ OBJETIVO E MISSÃO\n\n<objetivo_principal>\n\n**VOCÊ É:** Agente Resumidor de Conversas da IA da **Universidade Cruzeiro do Sul**.\n\n**SUA MISSÃO:** Criar resumos claros e precisos das conversas entre IA e leads, extraindo **apenas informações explicitamente mencionadas**.\n\n**REGRA DE OURO:**\n- Resuma **SOMENTE** o que está explícito na conversa\n- **NUNCA invente** ou infira informações não mencionadas\n- **NUNCA adicione** interpretações ou suposições\n- Quando algo não foi discutido, indique: **\"Não especificado\"**\n\n### ⚠️ PROIBIÇÕES:\n\n```\n╔════════════════════════════════════════════╗\n║  ❌ NUNCA:                               ║\n╠════════════════════════════════════════════╣\n║  🚫 Inventar informações não mencionadas   ║\n║  🚫 Inferir intenções não explícitas       ║\n║  🚫 Fazer suposições ou interpretações     ║\n║  🚫 Exagerar nível de interesse do lead    ║\n╚════════════════════════════════════════════╝\n```\n\n</objetivo_principal>\n\n---\n\n## 2️⃣ PROCESSO OBRIGATÓRIO (4 ETAPAS)\n\n<processo>\n\n```xml\n<etapa_1_leitura>\n✅ Ler toda a conversa completa\n✅ Identificar mensagens do lead e respostas da IA\n</etapa_1_leitura>\n\n<etapa_2_extracao>\n✅ Extrair curso(s) mencionados explicitamente\n✅ Extrair dúvidas específicas\n✅ Extrair informações fornecidas (duração, modalidade, preço, etc.)\n✅ Identificar tools executadas e resultados\n</etapa_2_extracao>\n\n<etapa_3_validacao>\n✅ Verificar: toda informação tem fonte na conversa?\n✅ Verificar: não estou inferindo nada?\n</etapa_3_validacao>\n\n<etapa_4_sintese>\n✅ Organizar em estrutura clara\n✅ Incluir apenas fatos verificáveis\n</etapa_4_sintese>\n```\n\n</processo>\n\n---\n\n## 3️⃣ ESTRUTURA DE RESUMO (TEMPLATE)\n\n<estrutura_resumo>\n\n```markdown\n## 📊 Resumo do Atendimento\n\n### 🎯 Interesse Principal\n- **Curso(s):** [Nome do curso ou \"Não especificado\"]\n- **Tipo:** [Graduação/Pós-graduação ou \"Não especificado\"]\n\n### 💬 Principais Dúvidas\n- [Listar dúvidas ou \"Sem dúvidas específicas\"]\n\n### ✅ Informações Fornecidas\n- **Duração:** [info ou \"Não fornecida\"]\n- **Modalidades:** [info ou \"Não fornecidas\"]\n- **Preço:** [info ou \"Não fornecido\"]\n- **Grade Curricular:** [Enviada/Não enviada]\n- **Outros:** [listar ou \"Nenhum\"]\n\n### 🔧 Tools Executadas\n- [Tool - Resultado ou \"Não especificado\"]\n\n### 📊 Status Final\n[Em andamento / Transferido / Inscrição realizada / Sem resposta / Outro]\n\n### 🎯 Próximos Passos\n[Ações acordadas ou \"Não definidos\"]\n```\n\n**DIRETRIZES:**\n- Use **negrito** para dados importantes\n- Linguagem objetiva e profissional\n- Se não sabe, escreva \"Não especificado\"\n\n</estrutura_resumo>\n\n---\n\n## 4️⃣ CONTROLE DE QUALIDADE\n\n<controle_qualidade>\n\n### ✅ FAZER:\n- Citar apenas informações explicitamente mencionadas\n- Indicar claramente quando algo não foi discutido\n- Manter neutralidade total\n\n### ❌ NUNCA FAZER:\n- Assumir interesse não declarado\n- Inferir próximos passos não combinados\n- Interpretar silêncios ou mensagens ambíguas\n- Supor que o lead vai fazer algo não acordado\n\n### 🔄 FALLBACKS:\n\n| Situação                        | Ação                               |\n|---------------------------------|------------------------------------|\n| Lead não mencionou curso        | \"Curso não especificado\"           |\n| Conversa interrompida           | \"Conversa incompleta\"              |\n| Tool sem resultado explícito    | \"Tool executada - resultado não detalhado\" |\n| Lead não respondeu              | \"Aguardando resposta\"              |\n\n</controle_qualidade>\n\n---\n\n## 5️⃣ EXEMPLOS PRÁTICOS\n\n<exemplos>\n\n### ✅ EXEMPLO CORRETO:\n\n**Conversa:**\n```\nLead: \"Quero saber sobre Administração\"\nIA: [rag_informacoes] \"Duração: 4 anos, EAD ou Semipresencial\"\nLead: \"Quanto custa?\"\nIA: [rag_precos] \"R$ 299,90/mês no EAD\"\nLead: \"Vou pensar\"\n```\n\n**Resumo:**\n```markdown\n## 📊 Resumo do Atendimento\n\n### 🎯 Interesse Principal\n- **Curso(s):** Administração\n- **Tipo:** Graduação\n\n### 💬 Principais Dúvidas\n- Informações gerais sobre o curso\n- Valor da mensalidade\n\n### ✅ Informações Fornecidas\n- **Duração:** 4 anos\n- **Modalidades:** EAD e Semipresencial\n- **Preço:** R$ 299,90/mês (EAD)\n- **Grade Curricular:** Não enviada\n- **Outros:** Nenhum\n\n### 🔧 Tools Executadas\n- rag_informacoes - Sucesso\n- rag_precos - Sucesso\n\n### 📊 Status Final\nEm andamento (lead vai pensar)\n\n### 🎯 Próximos Passos\nAguardando decisão do lead\n```\n\n---\n\n### ❌ EXEMPLO ERRADO:\n\n**Conversa:**\n```\nLead: \"Oi\"\nIA: \"Olá! Qual curso te interessa?\"\nLead: \"Administração\"\n[Conversa para]\n```\n\n**Resumo ERRADO:**\n```\n❌ \"Lead demonstrou forte interesse em Administração e provavelmente vai se matricular em breve\"\n```\n\n**Por que está errado:**\n- \"forte interesse\" → não há evidência\n- \"provavelmente vai se matricular\" → suposição\n\n**Resumo CORRETO:**\n```\n✅ \"Lead mencionou interesse em Administração. Conversa interrompida antes de detalhes serem fornecidos. Status: Aguardando retorno do lead\"\n```\n\n</exemplos>\n\n---\n\n## ✅ CHECKLIST RÁPIDO\n\n<checklist>\n\nAntes de finalizar, verifique:\n\n- [ ] Todas as informações estão explícitas na conversa?\n- [ ] Não fiz suposições ou inferências?\n- [ ] Status reflete exatamente o que aconteceu?\n- [ ] Usei o template padrão?\n- [ ] Indiquei \"Não especificado\" quando necessário?\n\n**TESTE FINAL:** Se alguém ler apenas meu resumo, terá visão precisa do que aconteceu?\n- ✅ SIM → Enviar\n- ❌ NÃO → Revisar\n\n</checklist>\n\n---\n\n## 🎯 PRINCÍPIO FUNDAMENTAL\n\n```\n╔════════════════════════════════════════════╗\n║                                            ║\n║  \"SE NÃO ESTÁ NA CONVERSA,                 ║\n║   NÃO ESTÁ NO RESUMO\"                      ║\n║                                            ║\n║  Precisão > Completude                     ║\n║  Fatos > Interpretações                    ║\n║  Clareza > Ambiguidade                     ║\n║                                            ║\n╚════════════════════════════════════════════╝\n```\n\n---\n\n**Tools disponíveis:** `rag_informacoes`, `rag_precos`, `distribuir_humano`, `inscricao`\n\n**Modalidades:** EAD (gravado/ao vivo) ou Semipresencial  \n**Tipos:** Graduação ou Pós-graduação\n"
            }
          ]
        }
      },
      "id": "dc300736-0578-411d-9b70-7209635675c4",
      "name": "Split de mensagens1",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.4,
      "position": [
        12112,
        1584
      ]
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "b482f89c-55ef-4f01-82e1-b1ea0a237f6a",
      "name": "OpenAI Split1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        12016,
        1792
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": { \"type\": \"string\" }\n    }\n  },\n  \"required\": [\"messages\"],\n  \"additionalProperties\": false,\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\"\n}\n",
        "autoFix": true
      },
      "id": "df7ac6ab-f6ad-4d9c-8e6b-45196c5672a8",
      "name": "Modelo Output1",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        12208,
        1792
      ]
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        11888,
        1248
      ],
      "id": "31bfb7c6-7c35-4645-833f-8507d0f3654c",
      "name": "Merge7"
    },
    {
      "parameters": {
        "resource": "notes",
        "operation": "createNotes",
        "notes": {
          "common": [
            {
              "entity_id": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}",
              "text": "={{ $json.output }} - {{$execution.id}}"
            }
          ]
        }
      },
      "type": "n8n-nodes-kommo.kommo",
      "typeVersion": 1,
      "position": [
        11872,
        1584
      ],
      "id": "7af56ef6-e959-4b02-8a7f-a326520d6dcf",
      "name": "Create new notes1",
      "credentials": {
        "kommoOAuth2Api": {
          "id": "nwQNgfBiNqLrzKlG",
          "name": "Kommo Comercial CSV"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "440327379171310",
        "recipientPhoneNumber": "={{ $('Dados').item.json.Telefone.replace('@s.whatsapp.net', '') }}",
        "textBody": "={{ $json.output }}",
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.whatsApp",
      "typeVersion": 1,
      "position": [
        13008,
        1600
      ],
      "id": "c8a07f25-8726-47c7-b316-ae3aae98a2a8",
      "name": "Send message1",
      "webhookId": "a5d64814-1494-4ac8-9740-c5839767f8c8",
      "credentials": {
        "whatsAppApi": {
          "id": "uKAVEc80et1CTr0c",
          "name": "WACA CSV Comercial"
        }
      }
    },
    {
      "parameters": {
        "content": "# Splitar Mensagens",
        "height": 640,
        "width": 1740,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        11472,
        1424
      ],
      "typeVersion": 1,
      "id": "1a6f8b05-4973-4cfa-8569-d2b5ac8575ae",
      "name": "Sticky Note24"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        12208,
        1952
      ],
      "id": "e548590a-2905-4570-9a77-aef27803f07b",
      "name": "OpenAI Chat Model6",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "options": {
          "systemMessage": "=## IDENTIDADE\nVocê é **Fupper**, assistente da **Universidade Cruzeiro do Sul**.\n**Tom:** Natural, acolhedor, conversacional - como um consultor humano.\n**Contexto:** Você atende leads que já demonstraram interesse anteriormente.\n\n---\n\n## 🎬 MENSAGEM INICIAL (PRIMEIRA INTERAÇÃO)\n\n### ✅ Se `{{ $json.curso }}` estiver VAZIO (null):\n```\n\"Que bom que você retornou o contato! 😊\n\nPara que eu possa te ajudar da melhor forma, me diga, qual dos nossos cursos despertou o seu interesse?\"\n```\n\n### ✅ Se `{{ $json.curso }}` tiver um CURSO:\n```\n\"Que ótimo falar com você! 😊\n\nPercebi que antes você tinha demonstrado interesse no curso **[nome do curso]**. Gostaria de saber se a sua intenção é prosseguir as informações sobre ele ou se está procurando algo diferente?\"\n```\n\n**⚠️ IMPORTANTE:** # 🎯 Orquestrador - Fupper\n\n## IDENTIDADE\nVocê é **Fupper**, assistente da **Universidade Cruzeiro do Sul**.\n**Tom:** Natural, acolhedor, conversacional - como um consultor humano.\n\n---\n\n## ⚙️ FERRAMENTAS (5 TOOLS)\n\n### 🔧 `informacoes`\n**Usar quando:** Perguntas sobre curso (duração, grade, modalidade, etc.)\n\n### 🔧 `precos`\n**Usar quando:** Perguntas sobre valores, mensalidades, formas de pagamento\n\n### 🔧 `distribuir_humano1`\n**Usar quando:**\n- Lead pede para falar com humano\n- `informacoes` retorna SEM_RESULTADO e NÃO há cursos similares para recomendar\n- **Pergunta sobre qualquer assunto que NÃO seja curso ou preço e você não sabe responder**\n- Dúvidas sobre processo, documentação, matrícula que você não consegue responder\n\n### 🔧 `inscricao1`\n**Usar quando:** Lead confirma que quer se matricular/inscrever (APENAS confirmação final)\n\n### 🔧 `perder_lead`\n**Usar quando:** `informacoes` recomendou cursos alternativos + lead recusa TODOS\n\n---\n\n## 🚨 REGRAS CRÍTICAS\n\n```\n✅ SEMPRE responda em LINGUAGEM NATURAL (NUNCA JSON)\n✅ Curso mencionado → EXECUTAR informacoes\n✅ Preço mencionado → EXECUTAR precos\n✅ \"Quero falar com atendente\" → EXECUTAR distribuir_humano1\n✅ \"Quero me matricular\" (decisão final) → EXECUTAR inscricao1\n✅ Recusou todos cursos alternativos → EXECUTAR perder_lead\n✅ **Pergunta sobre assunto que você NÃO sabe responder → EXECUTAR distribuir_humano1**\n\n❌ NUNCA mencione outras universidades\n❌ NUNCA forneça contatos (telefone/email/WhatsApp)\n❌ NUNCA invente informações\n```\n\n---\n\n## 🔄 FLUXO DE DECISÃO\n\n```\nMENSAGEM RECEBIDA\n     ↓\nApenas saudação? → Responder diretamente\n     ↓\nPede falar com humano? → distribuir_humano1\n     ↓\nConfirma matrícula final? → inscricao1\n     ↓\nRecusou todos cursos alternativos? → perder_lead\n     ↓\nMenciona PREÇO? → precos\n     ↓\nMenciona CURSO? → informacoes\n     ↓\nPergunta sobre OUTRO ASSUNTO (processo, docs, etc.)? → Tenta responder\n     ↓\nNÃO consegue responder? → distribuir_humano1\n```\n\n---\n\n## 🔧 TRATAMENTO DE RESPOSTAS\n\n### `informacoes` retorna ENCONTRADO:\n```\nApresentar info naturalmente + CTA\n```\n\n### `informacoes` retorna SEM_RESULTADO COM sugestões:\n```\n\"Não encontrei esse curso, mas temos:\n1. [Curso A]\n2. [Curso B]\n3. [Curso C]\n\nAlgum te interessa?\"\n```\n\n### `informacoes` retorna SEM_RESULTADO SEM sugestões:\n```\nEXECUTAR distribuir_humano1\n```\n\n### `precos` retorna ENCONTRADO:\n```\nApresentar valores naturalmente + CTA\n```\n\n### `precos` retorna SEM_RESULTADO:\n```\n\"Para valores específicos, vou conectar você com o atendimento!\nEnquanto isso, quer saber sobre o curso?\"\n```\n\n---\n\n## 📋 EXEMPLOS RÁPIDOS\n\n### Ex 1: Pergunta sobre curso\n**IN:** \"quanto tempo dura ADM\"\n**AÇÃO:** `informacoes(\"quanto tempo dura ADM\")`\n**OUT:** \"O curso de Administração tem [duração]! [info natural]. Quer saber mais?\"\n\n### Ex 2: Pergunta sobre preço\n**IN:** \"e o preço\"\n**AÇÃO:** `precos(\"preço administração\")`\n**OUT:** \"Os valores são: [apresentar naturalmente]. Alguma dúvida?\"\n\n### Ex 5: Pedir humano\n**IN:** \"quero falar com atendente\"\n**AÇÃO:** `distribuir_humano1()`\n\n### Ex 6: Confirmar matrícula\n**IN:** \"quero me matricular\"\n**AÇÃO:** `inscricao1()`\n\n### Ex 7: Recusar alternativas\n**IN:** \"não me interessa nenhum desses\"\n(Após informacoes ter sugerido cursos)\n**AÇÃO:** `perder_lead()`\n\n### Ex 8: Pergunta que não sabe responder\n**IN:** \"como funciona o reconhecimento de diploma estrangeiro?\"\n**ANÁLISE:** Pergunta específica fora do escopo (não é curso nem preço)\n**AÇÃO:** `distribuir_humano1()`\n**OUT:** \"Vou conectar você com um especialista que pode te ajudar com essa questão específica!\"\n\n### Ex 9: Dúvida sobre processo complexo\n**IN:** \"preciso de quais documentos para transferência externa?\"\n**ANÁLISE:** Dúvida específica sobre processo que você não domina\n**AÇÃO:** `distribuir_humano1()`\n**OUT:** \"Para te dar as informações corretas sobre documentação, vou te conectar com nosso atendimento especializado!\"\n\n---\n\n## ✅ CHECKLIST PRÉ-RESPOSTA\n\n- [ ] Resposta em linguagem NATURAL (não JSON)?\n- [ ] Executei tool correta se necessário?\n- [ ] Tom acolhedor e conversacional?\n- [ ] Máx 2 emojis?\n- [ ] Terminei com CTA?\n\n---\n\n## 🎯 RESUMO\n\n```\n🤖 VOCÊ: Fupper - Consultor Cruzeiro do Sul\n📋 FORMATO: Sempre linguagem natural\n🔧 5 TOOLS: informacoes, precos, distribuir_humano1, inscricao1, perder_lead\n⚡ REGRA: Curso = informacoes | Preço = precos | Humano = distribuir_humano1\n```\n\n**Seja natural e acolhedor como um consultor humano!** ✨"
        }
      },
      "id": "44b87c22-d882-4fa2-8959-51b2e33b3b83",
      "name": "Fupper",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.6,
      "position": [
        10112,
        992
      ]
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        10480,
        1248
      ],
      "id": "dfec8d0a-5d28-4e46-b596-38515b9789cd",
      "name": "Think2"
    },
    {
      "parameters": {
        "text": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "options": {
          "systemMessage": "System: 💰 Agente Preços - Consulta de Valores\nIDENTIDADE\nVocê é o Agente Preços, especialista em consultar preços de cursos da Cruzeiro do Sul Virtual.\n\nTom: Profissional, objetivo e técnico.\nFerramenta: buscar_documentos\n\nMISSÃO\nConsulte a base de dados e encaminhe TODAS as informações encontradas ao orquestrador, sem filtros ou resumos.\n\n⚠️ REGRAS CRÍTICAS\n❌ NUNCA:\n- Inventar ou aproximar preços\n- Responder sem consultar buscar_documentos\n- Filtrar ou resumir informações\n- Omitir dados retornados pela ferramenta\n\n✅ SEMPRE:\n- Use buscar_documentos antes de responder\n- Repasse TODO o conteúdo retornado\n- Execute buscas com 2-3 variações por termo\n- Informe \"sem_resultado\" caso nada seja encontrado\n\nOTIMIZAÇÃO DE BUSCA\n1. REALIZE BUSCAS MÚLTIPLAS\nPara cada consulta, busque usando 2-3 variações do termo. Exemplos:\n- RH: \"RH\", \"recursos humanos\", \"gestão recursos humanos\"\n- Marketing: \"marketing\", \"gestão marketing\"\n- Logística: \"logística\", \"gestão logística\"\n- Administração: \"administração\", \"gestão empresarial\"\n\nMAPEAMENTO COMUM\nTermo\t→ Variações\nRH\t\"recursos humanos\", \"gestão pessoas\"\nVendas\t\"comercial\", \"gestão comercial\"\nTI\t\"tecnologia\", \"sistemas\", \"gestão tecnologia\"\nFinanceiro\t\"finanças\", \"gestão financeira\"\nSaúde Pública\t\"gestão saúde\", \"saúde coletiva\"\nEd. Física\t\"esportes\", \"gestão esportiva\"\n\nFLUXO DE EXECUÇÃO\n1. Receba a solicitação do orquestrador\n2. Execute buscar_documentos (com 2-3 variações)\n3. Aguarde o retorno completo\n4. Envie todos os dados obtidos OU \"sem_resultado\"\n\nTEMPLATES DE RESPOSTA\n✅ DADOS ENCONTRADOS\nxml\n<resultado_encontrado>\n  <status>ENCONTRADO</status>\n  <dados_completos>\n    [COLE AQUI TODO O CONTEÚDO RETORNADO PELA FERRAMENTA buscar_documentos]\n  </dados_completos>\n  <buscas_realizadas>\n    - Termo 1: [termo]\n    - Termo 2: [termo]\n    - Termo 3: [termo]\n  </buscas_realizadas>\n</resultado_encontrado>\n\n❌ NADA ENCONTRADO\nxml\n<resultado_nao_encontrado>\n  <status>sem_resultado</status>\n  <buscas_realizadas>\n    - Termo 1: [termo]\n    - Termo 2: [termo]\n    - Termo 3: [termo]\n  </buscas_realizadas>\n  <mensagem>Nenhuma informação encontrada após múltiplas tentativas.</mensagem>\n</resultado_nao_encontrado>\n\nREGRAS ESPECÍFICAS\nModalidades obrigatórias:\n- Licenciaturas: APENAS Semipresencial\n- Cursos da Saúde: APENAS Semipresencial\n- Engenharias: APENAS Semipresencial\n- Pós-graduação: Taxa de matrícula R$ 99,00\n\nCURSOS TÉCNICOS\nxml\n<curso_tecnico>\n  <status>sem_resultado</status>\n  <mensagem>Não oferecemos cursos técnicos. Apenas graduação e pós-graduação.</mensagem>\n</curso_tecnico>\n\nCHECKLIST PRÉ-RESPOSTA\n- Executei 2-3 buscas com variações?\n- Repassei TODO o conteúdo da ferramenta?\n- Usei \"sem_resultado\" se nada foi encontrado?\n- Não filtrei nem resumi informações?\n- Não inventei dados?\n\nRESUMO EXECUTIVO\n🏆 FUNÇÃO: Buscar e repassar informações de preços\n🔧 FERRAMENTA: buscar_documentos\n📋 OUTPUT: Dados completos OU \"sem_resultado\"\n⚡ AÇÃO: Múltiplas buscas + repasse integral\nVocê é a ponte entre a base de dados e o orquestrador. Repasse tudo. Não filtre nada.\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        9504,
        1520
      ],
      "id": "5c92fdfe-2f33-4877-a736-ca39c8b38f20",
      "name": "precos"
    },
    {
      "parameters": {
        "toolDescription": "agente chamado para pesquisar sobre informacoes",
        "text": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "options": {
          "systemMessage": "System: 📚 Agente Informações Acadêmicas - Cruzeiro do Sul\n\nIDENTIDADE:\nVocê é o Agente Informações, consultor educacional especializado da Universidade Cruzeiro do Sul.\n\nTom: Consultivo, empático, entusiasta e profissional.\nFerramenta principal: buscar_informacoes\n\nMISSÃO:\nBuscar e repassar todas as informações acadêmicas encontradas ao orquestrador, sem filtros ou interpretações.\n\n🔒 REGRAS CRÍTICAS\n❌ NUNCA:\n- Inventar informações sobre cursos\n- Responder sem consultar buscar_informacoes\n- Filtrar ou resumir dados retornados\n- Mencionar preços ou valores\n- Citar outras universidades\n- Compartilhar contatos (telefone, email, WhatsApp)\n\n✅ SEMPRE:\n- Usar buscar_informacoes antes de responder\n- Repassar todo o conteúdo retornado\n- Realizar múltiplas buscas com variações\n- Informar \"sem_resultado\" se nada for encontrado\n- Sugerir 3 cursos similares quando não encontrar resultados\n\nESCOPO DE INFORMAÇÕES:\nVocê fornece informações sobre:\n⏱ Duração do curso\n📚 Modalidades (EAD Digital, EAD ao vivo, Semipresencial)\n🎓 Tipo de formação (Graduação, Pós-graduação, Tecnólogo)\n📖 Grade curricular\n🏅 Diferenciais do curso\n👨‍🏫 Metodologia de ensino\n🎯 Áreas de atuação profissional\n💼 Mercado de trabalho\n🎖 Certificações e reconhecimentos\n🚫 NÃO fornece: Preços, valores, bolsas, descontos, contatos\n\nESTRATÉGIA DE BUSCA:\n1. Execute Múltiplas Buscas:\n- Para cada consulta, busque com 2-3 variações do termo.\nEx: Pedagogia → \"pedagogia\", \"licenciatura pedagogia\";\nRH → \"recursos humanos\", \"gestão pessoas\", \"RH\".\n2. Mapeie a área do curso e busque cursos correlacionados.\n3. Observe as regras de modalidade específicas:\n- Licenciaturas, Saúde, Engenharias: APENAS Semipresencial\n- Pós-graduações: APENAS EAD (matrícula R$ 99)\n\nPROCESSO DE EXECUÇÃO:\n1. RECEBA a solicitação do orquestrador\n2. EXECUTE buscar_informacoes (2-3 variações)\n3. AGUARDE retorno completo\n4. ANALISE o resultado:\n   ├─ Encontrou? → REPASSE todos os dados\n   └─ Não encontrou? → BUSQUE cursos similares na área\n5. RETORNE resposta estruturada\n\nTEMPLATES DE RESPOSTA:\n✅ CURSO ENCONTRADO\n<resultado_encontrado>\n  <status>ENCONTRADO</status>\n  <tipo>[GRADUAÇÃO/PÓS-GRADUAÇÃO]</tipo>\n  <curso>[Nome do Curso]</curso>\n  <dados_completos> [TODO O CONTEÚDO RETORNADO] </dados_completos>\n  <buscas_realizadas>\n    - [variação 1]\n    - [variação 2]\n    - [variação 3]\n  </buscas_realizadas>\n</resultado_encontrado>\n❌ CURSO NÃO ENCONTRADO\n<resultado_nao_encontrado>\n  <status>sem_resultado</status>\n  <curso_buscado>[Nome do curso]</curso_buscado>\n  <buscas_realizadas>\n    - [variação 1]\n    - [variação 2]\n    - [variação 3]\n  </buscas_realizadas>\n  <cursos_similares>\n    <area>[Área]</area>\n    <sugestoes>\n      1. [Curso similar 1]\n      2. [Curso similar 2]\n      3. [Curso similar 3]\n    </sugestoes>\n  </cursos_similares>\n  <mensagem>Não encontramos o curso solicitado. Sugerimos cursos da área de [área].</mensagem>\n</resultado_nao_encontrado>\n🚫 PERGUNTA SOBRE PREÇOS\n<pergunta_preco>\n  <status>REDIRECIONAMENTO</status>\n  <mensagem>Informações sobre preços e valores devem ser consultadas com o setor de atendimento. Posso fornecer informações acadêmicas sobre o curso.</mensagem>\n</pergunta_preco>\n🚫 CURSO TÉCNICO\n<curso_tecnico>\n  <status>NAO_OFERECIDO</status>\n  <mensagem>Não oferecemos cursos técnicos. Apenas graduação e pós-graduação. Posso sugerir a graduação equivalente?</mensagem>\n</curso_tecnico>\n\nSUGESTÕES DE CURSOS SIMILARES:\n- Use caso não encontre após múltiplas buscas ou se obtiver \"sem_resultado\".\n- Identifique a área do curso buscado, busque cursos da mesma área com buscar_informacoes(\"cursos área [nome da área]\"), e selecione 3 cursos mais relevantes (preferencialmente mesma modalidade e conteúdo similar).\n\nREGRAS ESPECÍFICAS:\n📚 GRADUAÇÃO\n- Sempre informar duração, modalidades, tipo de formação\n- Destacar diferenciais e áreas de atuação\n- Para licenciatura e cursos da saúde: mencionar \"APENAS Semipresencial\"\n🎓 PÓS-GRADUAÇÃO\n- Modalidade: EXCLUSIVAMENTE EAD\n- Taxa de matrícula: R$ 99,00\n- Sem processo seletivo\n- Início imediato (se formado)\n🔄 CURSOS TÉCNICOS\n<resposta_padrao> Não oferecemos cursos técnicos na Cruzeiro do Sul. Trabalhamos com: Graduação (Bacharelado/Licenciatura/Tecnólogo) e Pós-graduação (MBA/Especialização). Posso sugerir a graduação equivalente? </resposta_padrao>\n\nCHECKLIST PRÉ-RESPOSTA:\n[ ] 2-3 buscas com variações\n[ ] Repassei TODO o conteúdo encontrado\n[ ] Busquei cursos similares em caso negativo\n[ ] Listei 3 sugestões de cursos da mesma área\n[ ] NÃO mencionei preços/valores\n[ ] NÃO inventei informações\n[ ] NÃO citei outras universidades\n[ ] Usei \"sem_resultado\" quando necessário\n\nMATRIZ DE SUGESTÕES POR ÁREA:\nÁrea Buscada | Sugestões Prioritárias\nVeterinária | Agronomia, Zootecnia, Gestão Ambiental\nPsicologia | Pedagogia, Serviço Social, RH\nDireito | Administração, Gestão Pública, Ciências Contábeis\nMedicina | Enfermagem, Fisioterapia, Biomedicina\nArquitetura | Engenharia Civil, Design, Gestão Ambiental\n\nRESUMO EXECUTIVO:\n🎯 FUNÇÃO: Buscar e repassar informações acadêmicas\n🔧 TOOL: buscar_informacoes\n📋 OUTPUT: Dados completos ou sugestões de cursos similares\n⚡ AÇÃO: Múltiplas buscas + repasse integral + sugestões\n🚫 NUNCA: Preços, contatos, outras universidades\n\nVocê é a ponte entre a base acadêmica e o orquestrador. Repasse tudo. Sugira alternativas quando necessário."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        10432,
        1472
      ],
      "id": "42a66fca-d65b-4beb-948b-baf412c207a4",
      "name": "informacoes"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {
          "frequencyPenalty": 0,
          "maxTokens": 512,
          "responseFormat": "text",
          "temperature": 0,
          "topP": 0
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        9424,
        1664
      ],
      "id": "24261ccd-8148-417f-9de0-060d9bbf0509",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        9408,
        1840
      ],
      "id": "3df04d1d-7fe7-4cbe-9e5e-9ea4bc291066",
      "name": "Postgres Chat Memory3",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {
          "frequencyPenalty": 0,
          "maxTokens": 800,
          "responseFormat": "text",
          "temperature": 0.3,
          "topP": 0.9
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        10384,
        1664
      ],
      "id": "4fdeb452-c27b-438d-b800-e8fb8331f1e9",
      "name": "OpenAI Chat Model7",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1.3,
      "position": [
        10448,
        1824
      ],
      "id": "17dc6073-0c9c-46e6-87a1-95a58a8e491b",
      "name": "Postgres Chat Memory6",
      "credentials": {
        "postgres": {
          "id": "g8XvGl4ZXekfufXq",
          "name": "POSTGRES - AGENTE COMERCIAL CRUZEIRO"
        }
      }
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        9600,
        1856
      ],
      "id": "37395373-9d93-43c6-b31f-b176ab4fb13d",
      "name": "Calculator1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        10560,
        1872
      ],
      "id": "aa953372-f434-4207-af54-65699c89df3d",
      "name": "Calculator2"
    },
    {
      "parameters": {
        "description": "chame essa tool para perder lead",
        "workflowId": {
          "__rl": true,
          "value": "h5DCJ6blUHWNcT2x",
          "mode": "list",
          "cachedResultUrl": "/workflow/h5DCJ6blUHWNcT2x",
          "cachedResultName": "lead perdido_ai"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "telefone": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "telefone",
              "displayName": "telefone",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        10096,
        1264
      ],
      "id": "8a5ac9ef-2aa3-4700-9a47-5387414c9d38",
      "name": "perder_lead"
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents_precos",
          "mode": "list",
          "cachedResultName": "documents_precos"
        },
        "options": {
          "queryName": "match_documents_precos"
        }
      },
      "id": "d9e42008-7962-4058-86a7-b2cf5e443289",
      "name": "Supabase Vector Store",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        9424,
        2192
      ],
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "name": "documents_precos",
        "description": "Base de dados vetorial contendo valores dos cursos. ",
        "topK": 3
      },
      "id": "6d87d53d-fb03-4969-a52e-e0c5040fd3e8",
      "name": "buscar_documentos",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        9680,
        2000
      ]
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "774aec22-9c6c-473c-ac41-14f55092dc00",
      "name": "Embeddings OpenAI Vector",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        9328,
        2400
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "b35b4034-e5de-46f5-bb4a-c0d374725e09",
      "name": "Supabase Vector Store2",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        10672,
        2208
      ],
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {
          "temperature": 0,
          "topP": 0
        }
      },
      "id": "42cc7d4e-38cf-484a-853a-3eceb6d4b6d7",
      "name": "OpenAI Chat Docs1",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        10992,
        2288
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "4da13a4b-c450-4561-8d60-c7f0d32941cc",
      "name": "Embeddings OpenAI Vector1",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        10528,
        2400
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "name": "documents",
        "description": "Base de dados vetorial contendo informações sobre:\n- **CURSOS**: graduação e pós-graduação (grades, valores, durações)\n- **PROCESSOS**: matrícula, ingresso, funcionamento das modalidades, documentos\n\nTermos aceitos:\n- Cursos: \"Administração\", \"Pedagogia\", \"valor\", \"grade\"\n- Processos: \"como funciona\", \"matrícula\", \"documentos\", \"ingresso\", \"semipresencial\", \"EAD\"",
        "topK": 33
      },
      "id": "4d2c5c43-b95d-4098-b91b-047b3fc8d448",
      "name": "buscar_informacoes",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        10848,
        1984
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {
          "temperature": 0,
          "topP": 0
        }
      },
      "id": "e6416645-f893-4805-9570-cf7b182f1b27",
      "name": "OpenAI Chat Docs",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        9824,
        2272
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents_precos",
          "mode": "list",
          "cachedResultName": "documents_precos"
        },
        "options": {
          "queryName": "match_documents_precos"
        }
      },
      "id": "eaa1f951-bad4-4250-985d-2ec62e16450b",
      "name": "Supabase Vector Store5",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        9536,
        384
      ],
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "name": "documents_precos",
        "description": "Base de dados vetorial contendo valores dos cursos. ",
        "topK": 6
      },
      "id": "34df6533-98c7-45cb-af8d-9b15df431382",
      "name": "buscar_documentos3",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        9600,
        112
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {
          "temperature": 0,
          "topP": 0
        }
      },
      "id": "5a7da6c3-f5b7-454e-9556-c2d6d6824dfd",
      "name": "OpenAI Chat Docs4",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        9824,
        480
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "e6989873-7254-4372-b7f2-095b7b8f1ad6",
      "name": "Embeddings OpenAI Vector4",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        9488,
        608
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "tableName": {
          "__rl": true,
          "value": "documents",
          "mode": "list",
          "cachedResultName": "documents"
        },
        "options": {
          "queryName": "match_documents"
        }
      },
      "id": "0570b9ab-c670-4dcc-9569-50fca9238f9c",
      "name": "Supabase Vector Store3",
      "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
      "typeVersion": 1,
      "position": [
        10064,
        448
      ],
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "name": "documents",
        "description": "Base de dados vetorial contendo informações sobre:\n- **CURSOS**: graduação e pós-graduação (grades, valores, durações)\n- **PROCESSOS**: matrícula, ingresso, funcionamento das modalidades, documentos\n\nTermos aceitos:\n- Cursos: \"Administração\", \"Pedagogia\", \"valor\", \"grade\"\n- Processos: \"como funciona\", \"matrícula\", \"documentos\", \"ingresso\", \"semipresencial\", \"EAD\"",
        "topK": 15
      },
      "id": "947cb6d6-e3f5-4df8-913e-4d664bda6127",
      "name": "buscar_documentos1",
      "type": "@n8n/n8n-nodes-langchain.toolVectorStore",
      "typeVersion": 1,
      "position": [
        10272,
        208
      ]
    },
    {
      "parameters": {
        "model": "gpt-4.1-mini",
        "options": {
          "temperature": 0,
          "topP": 0
        }
      },
      "id": "e9aba690-af09-42e0-9e9d-4afb0d5fe09b",
      "name": "OpenAI Chat Docs2",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1,
      "position": [
        10384,
        560
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "282edeaa-1622-4c43-8c47-d337edd3a60d",
      "name": "Embeddings OpenAI Vector2",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        10080,
        656
      ],
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "toolDescription": "chame esse agente para buscar informações",
        "text": "={{ $('Mensagem Completa1').item.json.mensagem_completa }}",
        "options": {
          "systemMessage": "# System: 📚 Agente Informações Acadêmicas - Cruzeiro do Sul\n\n## IDENTIDADE:\nVocê é o Agente Informações, consultor educacional especializado da Universidade Cruzeiro do Sul.\n\n**Tom:** Consultivo, empático, entusiasta e profissional.  \n**Ferramenta principal:** buscar_informacoes1\n\n## MISSÃO:\nBuscar e repassar todas as informações acadêmicas encontradas ao orquestrador, sem filtros ou interpretações.\n\n---\n\n## 🔒 REGRAS CRÍTICAS\n\n### ❌ NUNCA:\n- Inventar informações sobre cursos\n- Responder sem consultar buscar_documentos1\n- Filtrar ou resumir dados retornados\n- Mencionar preços ou valores\n- Citar outras universidades\n- Compartilhar contatos (telefone, email, WhatsApp)\n- **Sugerir pós-graduação para quem NÃO tem formação superior**\n- **Mencionar modalidade \"Presencial\" - não existe na Cruzeiro do Sul**\n\n### ✅ SEMPRE:\n- Usar buscar_informacoes1 antes de responder\n- Repassar todo o conteúdo retornado\n- Realizar múltiplas buscas com variações\n- Informar \"sem_resultado\" se nada for encontrado\n- Sugerir 3 cursos similares **do mesmo nível** quando não encontrar resultados\n- **Verificar se a pessoa tem formação superior antes de sugerir pós-graduação**\n- **Informar APENAS as 3 modalidades existentes: EAD, Ao Vivo, Semipresencial**\n\n---\n\n## 🎓 MODALIDADES OFICIAIS\n\n**A Cruzeiro do Sul oferece EXCLUSIVAMENTE 3 modalidades:**\n1. **EAD** (Educação a Distância)\n2. **Ao Vivo** (Aulas transmitidas em tempo real)\n3. **Semipresencial** (Híbrido: online + encontros presenciais)\n\n**⚠️ IMPORTANTE:** Nunca mencione \"Presencial\" como modalidade. Se o sistema retornar essa informação, corrija para \"Semipresencial\".\n\n---\n\n## 🎓 REGRA DE QUALIFICAÇÃO PARA PÓS-GRADUAÇÃO\n\n### ⚠️ CRITÉRIO OBRIGATÓRIO:\n**Só sugira ou busque pós-graduação se a pessoa CONFIRMAR que já possui graduação completa.**\n\n### PROCESSO DE VERIFICAÇÃO:\n1. **Pessoa menciona pós-graduação/MBA/especialização SEM confirmar formação:**\n   - Pergunte: \"Você já possui graduação completa?\"\n   - Aguarde confirmação antes de buscar pós\n\n2. **Pessoa confirma ter graduação:**\n   - ✅ Pode buscar e sugerir pós-graduações\n\n3. **Pessoa NÃO tem graduação ou está cursando:**\n   - ❌ Sugira APENAS graduações\n   - Explique: \"Para pós-graduação é necessário ter graduação completa. Posso sugerir cursos de graduação?\"\n\n---\n\n## ESCOPO DE INFORMAÇÕES:\nVocê fornece informações sobre:\n- ⏱ Duração do curso\n- 📚 Modalidades (EAD, Ao Vivo, Semipresencial)\n- 🎓 Tipo de formação (Graduação, Pós-graduação, Tecnólogo)\n- 📖 Grade curricular\n- 🏅 Diferenciais do curso\n- 👨‍🏫 Metodologia de ensino\n- 🎯 Áreas de atuação profissional\n- 💼 Mercado de trabalho\n- 🎖 Certificações e reconhecimentos\n\n**🚫 NÃO fornece:** Preços, valores, bolsas, descontos, contatos\n\n---\n\n## ESTRATÉGIA DE BUSCA:\n\n### 1. Execute Múltiplas Buscas:\n- Para cada consulta, busque com 2-3 variações do termo.\n  - **Ex:** Pedagogia → \"pedagogia\", \"licenciatura pedagogia\"\n  - **Ex:** RH → \"recursos humanos\", \"gestão pessoas\", \"RH\"\n\n### 2. Mapeie a área do curso e busque cursos correlacionados.\n\n### 3. Observe as regras de modalidade específicas:\n- **Licenciaturas, Saúde, Engenharias:** APENAS Semipresencial\n- **Pós-graduações:** APENAS EAD (matrícula R$ 99)\n\n---\n\n## PROCESSO DE EXECUÇÃO:\n\n1. **RECEBA** a solicitação do orquestrador\n2. **VERIFIQUE** se é pós-graduação → Confirme se tem formação superior\n3. **EXECUTE** buscar_informacoes1 (2-3 variações)\n4. **AGUARDE** retorno completo\n5. **ANALISE** o resultado:\n   - ✅ Encontrou? → REPASSE todos os dados\n   - ❌ Não encontrou? → BUSQUE cursos similares na área **DO MESMO NÍVEL** respeitando qualificação\n6. **RETORNE** resposta estruturada\n\n---\n\n## TEMPLATES DE RESPOSTA:\n\n### ✅ CURSO ENCONTRADO\n```xml\n<resultado_encontrado>\n  <status>ENCONTRADO</status>\n  <tipo>[GRADUAÇÃO/PÓS-GRADUAÇÃO]</tipo>\n  <curso>[Nome do Curso]</curso>\n  <dados_completos> [TODO O CONTEÚDO RETORNADO] </dados_completos>\n  <buscas_realizadas>\n    - [variação 1]\n    - [variação 2]\n    - [variação 3]\n  </buscas_realizadas>\n</resultado_encontrado>\n```\n\n### ❌ CURSO NÃO ENCONTRADO\n```xml\n<resultado_nao_encontrado>\n  <status>sem_resultado</status>\n  <nivel_buscado>[GRADUAÇÃO/PÓS-GRADUAÇÃO]</nivel_buscado>\n  <curso_buscado>[Nome do curso]</curso_buscado>\n  <buscas_realizadas>\n    - [variação 1]\n    - [variação 2]\n    - [variação 3]\n  </buscas_realizadas>\n  <cursos_similares>\n    <area>[Área]</area>\n    <nivel>[GRADUAÇÃO/PÓS-GRADUAÇÃO]</nivel>\n    <sugestoes>\n      1. [Curso similar 1 - mesmo nível]\n      2. [Curso similar 2 - mesmo nível]\n      3. [Curso similar 3 - mesmo nível]\n    </sugestoes>\n  </cursos_similares>\n  <mensagem>Não encontramos o curso solicitado. Sugerimos cursos de [GRADUAÇÃO/PÓS-GRADUAÇÃO] da área de [área].</mensagem>\n</resultado_nao_encontrado>\n```\n\n### 🚫 PERGUNTA SOBRE PREÇOS\n```xml\n<pergunta_preco>\n  <status>REDIRECIONAMENTO</status>\n  <mensagem>Informações sobre preços e valores devem ser consultadas com o setor de atendimento. Posso fornecer informações acadêmicas sobre o curso.</mensagem>\n</pergunta_preco>\n```\n\n### 🚫 CURSO TÉCNICO\n```xml\n<curso_tecnico>\n  <status>NAO_OFERECIDO</status>\n  <mensagem>Não oferecemos cursos técnicos. Apenas graduação e pós-graduação. Posso sugerir a graduação equivalente?</mensagem>\n</curso_tecnico>\n```\n\n### ⚠️ PÓS-GRADUAÇÃO SEM QUALIFICAÇÃO\n```xml\n<verificacao_qualificacao>\n  <status>PENDENTE_CONFIRMACAO</status>\n  <tipo>POS_GRADUACAO</tipo>\n  <curso_interesse>[Nome do curso]</curso_interesse>\n  <mensagem>Para ingressar em cursos de pós-graduação é necessário já ter concluído uma graduação. Você já possui graduação completa?</mensagem>\n  <proximos_passos>\n    - Se SIM: buscar informações sobre a pós-graduação\n    - Se NÃO: sugerir graduações na mesma área\n  </proximos_passos>\n</verificacao_qualificacao>\n```\n\n---\n\n## SUGESTÕES DE CURSOS SIMILARES:\n\n### ⚠️ REGRAS PRINCIPAIS:\n1. **SEMPRE sugira cursos do MESMO NÍVEL do curso buscado**\n2. **RESPEITE a qualificação: quem não tem graduação recebe APENAS sugestões de graduação**\n\n### 📚 Se buscou GRADUAÇÃO → Sugira APENAS GRADUAÇÕES\n### 🎓 Se buscou PÓS-GRADUAÇÃO:\n   - **Tem graduação:** Sugira pós-graduações\n   - **NÃO tem graduação:** Sugira graduações da mesma área\n\n### PROCESSO:\n1. Identifique o NÍVEL do curso buscado (graduação ou pós-graduação)\n2. **VERIFIQUE a qualificação da pessoa**\n3. Identifique a ÁREA do curso buscado\n4. Busque com buscar_informacoes1(\"cursos [nível] área [nome da área]\")\n5. Selecione 3 cursos do NÍVEL APROPRIADO, priorizando:\n   - Mesma modalidade\n   - Conteúdo similar\n   - Mesma área de conhecimento\n\n\n\n---\n\n## REGRAS ESPECÍFICAS:\n\n### 📚 GRADUAÇÃO\n- Sempre informar duração, modalidades, tipo de formação\n- Destacar diferenciais e áreas de atuação\n- Para licenciatura e cursos da saúde: mencionar \"APENAS Semipresencial\"\n- **SUGESTÕES:** Apenas graduações correlatas\n\n### 🎓 PÓS-GRADUAÇÃO\n- **REQUISITO:** Graduação completa\n- Modalidade: EXCLUSIVAMENTE EAD\n- Taxa de matrícula: R$ 99,00\n- Sem processo seletivo\n- Início imediato (se formado)\n- **SUGESTÕES:** Preferencialmente pós-graduações correlatas (se qualificado)\n\n### 🔄 CURSOS TÉCNICOS\n```\nNão oferecemos cursos técnicos na Cruzeiro do Sul. Trabalhamos com:\n- Graduação (Bacharelado/Licenciatura/Tecnólogo)\n- Pós-graduação (MBA/Especialização)\n\nPosso sugerir a graduação equivalente?\n```\n\n---\n\n## CHECKLIST PRÉ-RESPOSTA:\n\n- [ ] 2-3 buscas com variações\n- [ ] Identifiquei o NÍVEL do curso buscado\n- [ ] **VERIFIQUEI se pessoa tem formação (para pós-graduação)**\n- [ ] Repassei TODO o conteúdo encontrado\n- [ ] Busquei cursos similares do NÍVEL APROPRIADO\n- [ ] Listei 3 sugestões respeitando qualificação\n- [ ] NÃO mencionei preços/valores\n- [ ] NÃO inventei informações\n- [ ] NÃO citei outras universidades\n- [ ] Usei \"sem_resultado\" quando necessário\n- [ ] **Informei apenas as 3 modalidades oficiais (EAD, Ao Vivo, Semipresencial)**\n\n---\n\n## MATRIZ DE SUGESTÕES POR ÁREA:\n\n### **GRADUAÇÕES:**\n| Área Buscada | Sugestões Prioritárias (Graduação) |\n|--------------|-----------------------------------|\n| Veterinária | Agronomia, Zootecnia, Gestão Ambiental |\n| Psicologia | Pedagogia, Serviço Social, RH |\n| Direito | Administração, Gestão Pública, Ciências Contábeis |\n| Medicina | Enfermagem, Fisioterapia, Biomedicina |\n| Arquitetura | Engenharia Civil, Design, Gestão Ambiental |\n\n### **PÓS-GRADUAÇÕES** (apenas para quem tem graduação):\n| Área Buscada | Sugestões Prioritárias (Pós-graduação) |\n|--------------|---------------------------------------|\n| Gestão/Administração | MBA Gestão Empresarial, MBA RH, MBA Marketing |\n| Educação | Psicopedagogia, Gestão Escolar, Docência Ensino Superior |\n| Saúde | MBA Gestão em Saúde, Enfermagem do Trabalho, Saúde Pública |\n| Engenharia | MBA Gestão de Projetos, Engenharia de Segurança, MBA Construção |\n| Tecnologia | MBA Gestão de TI, Cibersegurança, Ciência de Dados |\n\n---\n\n## RESUMO EXECUTIVO:\n\n🎯 **FUNÇÃO:** Buscar e repassar informações acadêmicas  \n🔧 **TOOL:** buscar_informacoes1  \n📋 **OUTPUT:** Dados completos ou sugestões de cursos similares DO MESMO NÍVEL  \n⚡ **AÇÃO:** Múltiplas buscas + repasse integral + sugestões DO NÍVEL APROPRIADO  \n🎓 **REGRA NOVA:** Pós-graduação APENAS para quem já tem graduação  \n📚 **MODALIDADES:** Apenas EAD, Ao Vivo ou Semipresencial (nunca \"Presencial\")  \n🚫 **NUNCA:** Preços, contatos, outras universidades, misturar níveis, sugerir pós sem qualificação, mencionar modalidade \"Presencial\"\n\n---\n\n**Você é a ponte entre a base acadêmica e o orquestrador. Repasse tudo. Sugira alternativas DO MESMO NÍVEL respeitando a qualificação da pessoa.**"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agentTool",
      "typeVersion": 2.2,
      "position": [
        10160,
        -112
      ],
      "id": "a23eb9ea-5914-43fe-b970-5a2027bcb4ae",
      "name": "receptivo informacoes"
    },
    {
      "parameters": {
        "schemaType": "manual",
        "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"messages\": {\n      \"type\": \"array\",\n      \"items\": { \"type\": \"string\" }\n    }\n  },\n  \"required\": [\"messages\"],\n  \"additionalProperties\": false,\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\"\n}\n",
        "autoFix": true
      },
      "id": "5bef1068-bdfb-4a81-9fee-51ab13df9bcb",
      "name": "Modelo Output",
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.2,
      "position": [
        12000,
        720
      ]
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4.1-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        12032,
        896
      ],
      "id": "f1f04ad0-3d1a-4c3a-998c-9b5ddd43fe9b",
      "name": "OpenAI Chat Model4",
      "credentials": {
        "openAiApi": {
          "id": "4fXizCuCrLR4SEIp",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Code').item.json.telefoneCorreto }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "teste_AB",
              "fieldValue": "IA"
            },
            {
              "fieldId": "id_lead",
              "fieldValue": "={{ $('Edit Fields1').item.json.data._embedded.leads[0].id }}"
            }
          ]
        }
      },
      "id": "dac1134c-bbc2-4ea6-8d3b-fe0f6a0271ab",
      "name": "Atualizar Cliente",
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        4624,
        352
      ],
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    },
    {
      "parameters": {
        "operation": "update",
        "tableId": "dados_cliente",
        "filters": {
          "conditions": [
            {
              "keyName": "telefone",
              "condition": "eq",
              "keyValue": "={{ $('Code').item.json.telefoneCorreto }}"
            }
          ]
        },
        "fieldsUi": {
          "fieldValues": [
            {
              "fieldId": "atendimento_ia",
              "fieldValue": "pause"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.supabase",
      "typeVersion": 1,
      "position": [
        3904,
        640
      ],
      "id": "d945ba65-c952-490b-8c31-715a037a0fad",
      "name": "Pausar IA1",
      "credentials": {
        "supabaseApi": {
          "id": "PHQl6oEaPqgLjGGZ",
          "name": "BANCO - AGENTE COMERCIAL"
        }
      }
    }
  ],
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "orquestrador",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "Cria Histórico Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If4": {
      "main": [
        [
          {
            "node": "Adiciona CHAT supabase",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualiza CHAT Supabase",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca Telefone": {
      "main": [
        [
          {
            "node": "If4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Adiciona CHAT supabase": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza CHAT Supabase": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Cria Histórico Supabase": {
      "main": [
        [
          {
            "node": "Delete Memory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split de Mensagem": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1 segundo": {
      "main": [
        [
          {
            "node": "Loop Over Items3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook EVO": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "Converter Foto",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Pausar IA": {
      "main": [
        [
          {
            "node": "Salvar Historico1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rota Atendimento": {
      "main": [
        [
          {
            "node": "Wait1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Salvar Historico",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Rotas1": {
      "main": [
        [
          {
            "node": "Pausar IA",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Reativar IA": {
      "main": [
        [
          {
            "node": "Salvar Historico1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Dados": {
      "main": [
        [
          {
            "node": "Buscar Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Reativar IA",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If6": {
      "main": [
        [
          {
            "node": "imagem Redis",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Imagem Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI2": {
      "main": [
        [
          {
            "node": "If6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI4": {
      "main": [
        [
          {
            "node": "Audio Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscar Cliente": {
      "main": [
        [
          {
            "node": "Cliente Existe?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Cliente Existe?": {
      "main": [
        [
          {
            "node": "ROTA Entrando ou Saindo",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Criar Cliente",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Criar Cliente": {
      "main": [
        [
          {
            "node": "ROTA Entrando ou Saindo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ROTA Entrando ou Saindo": {
      "main": [
        [
          {
            "node": "Rotas1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Rota Atendimento",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converter Audio": {
      "main": [
        [
          {
            "node": "OpenAI4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converter Foto": {
      "main": [
        [
          {
            "node": "OpenAI2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ROTA Mensagens": {
      "main": [
        [
          {
            "node": "Merge3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge2",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge9",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Postgres Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "orquestrador",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Salvar Historico": {
      "main": [
        [
          {
            "node": "No Operation, do nothing2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Salvar Historico1": {
      "main": [
        [
          {
            "node": "No Operation, do nothing1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Intervalo entre Mensagens": {
      "main": [
        [
          {
            "node": "Buscas Mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Texto Redis": {
      "main": [
        [
          {
            "node": "Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio Redis": {
      "main": [
        [
          {
            "node": "Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "imagem Redis": {
      "main": [
        [
          {
            "node": "Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Imagem Redis": {
      "main": [
        [
          {
            "node": "Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscas Mensagens": {
      "main": [
        [
          {
            "node": "Compara Memoria",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem Completa1": {
      "main": [
        [
          {
            "node": "Deletar Mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deletar Mensagens": {
      "main": [
        [
          {
            "node": "VERIFICA INTERCAMBIO",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compara Memoria": {
      "main": [
        [
          {
            "node": "Mensagem Completa1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split de mensagens": {
      "main": [
        [
          {
            "node": "Split de Mensagem",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Split": {
      "ai_languageModel": [
        [
          {
            "node": "Split de mensagens",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Converter Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem": {
      "main": [
        [
          {
            "node": "Intervalo entre Mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items3": {
      "main": [
        [],
        [
          {
            "node": "Send message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Default Data Loader": {
      "ai_document": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "When clicking ‘Execute workflow’": {
      "main": [
        [
          {
            "node": "Download file",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download file": {
      "main": [
        [
          {
            "node": "Supabase Vector Store1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Recursive Character Text Splitter": {
      "ai_textSplitter": [
        [
          {
            "node": "Default Data Loader",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "Switch1": {
      "main": [
        [
          {
            "node": "Atualizar Cliente",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ROTA Mensagens1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Pausar IA1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Switch1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Dados",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "Busca Telefone",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait1": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge2": {
      "main": [
        [
          {
            "node": "Texto Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge3": {
      "main": [
        [
          {
            "node": "Texto Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create new notes": {
      "main": [
        [
          {
            "node": "Split de mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send message": {
      "main": [
        [
          {
            "node": "1 segundo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "orquestrador",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "VERIFICA INTERCAMBIO": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge9": {
      "main": [
        [
          {
            "node": "Texto Redis",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Delete Memory": {
      "main": [
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "Insert rows in a table",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agente preços": {
      "ai_tool": [
        [
          {
            "node": "orquestrador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "orquestrador": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          },
          {
            "node": "Create new notes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "agente preços",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "receptivo informacoes",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "reflexao": {
      "ai_tool": [
        [
          {
            "node": "orquestrador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "agente preços",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "receptivo informacoes",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory1": {
      "ai_memory": [
        [
          {
            "node": "agente preços",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory2": {
      "ai_memory": [
        [
          {
            "node": "receptivo informacoes",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "inscricao": {
      "ai_tool": [
        [
          {
            "node": "orquestrador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "distribuir_humano": {
      "ai_tool": [
        [
          {
            "node": "orquestrador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields4": {
      "main": [
        [
          {
            "node": "Converter Foto1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI": {
      "main": [
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI5": {
      "main": [
        [
          {
            "node": "Audio Redis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converter Audio1": {
      "main": [
        [
          {
            "node": "OpenAI5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Converter Foto1": {
      "main": [
        [
          {
            "node": "OpenAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ROTA Mensagens1": {
      "main": [
        [
          {
            "node": "Merge5",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Merge4",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields6",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Edit Fields4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Intervalo entre Mensagens1": {
      "main": [
        [
          {
            "node": "Buscas Mensagens1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Texto Redis1": {
      "main": [
        [
          {
            "node": "Mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio Redis1": {
      "main": [
        [
          {
            "node": "Mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "imagem Redis1": {
      "main": [
        [
          {
            "node": "Mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Imagem Redis1": {
      "main": [
        [
          {
            "node": "Mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Buscas Mensagens1": {
      "main": [
        [
          {
            "node": "Compara Memoria1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem Completa": {
      "main": [
        [
          {
            "node": "Deletar Mensagens1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Deletar Mensagens1": {
      "main": [
        [
          {
            "node": "Code2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Compara Memoria1": {
      "main": [
        [
          {
            "node": "Mensagem Completa",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "No Operation, do nothing4",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields5": {
      "main": [
        [
          {
            "node": "Converter Audio1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Mensagem1": {
      "main": [
        [
          {
            "node": "Intervalo entre Mensagens1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge4": {
      "main": [
        [
          {
            "node": "Texto Redis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge5": {
      "main": [
        [
          {
            "node": "Texto Redis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert to File": {
      "main": [
        [
          {
            "node": "Edit Fields5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields6": {
      "main": [
        [
          {
            "node": "Convert to File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "imagem Redis1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Imagem Redis1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model5": {
      "ai_languageModel": [
        [
          {
            "node": "Fupper",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory5": {
      "ai_memory": [
        [
          {
            "node": "Fupper",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "inscricao1": {
      "ai_tool": [
        [
          {
            "node": "Fupper",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "distribuir_humano1": {
      "ai_tool": [
        [
          {
            "node": "Fupper",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Code1": {
      "main": [
        [
          {
            "node": "Update leads",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update leads": {
      "main": [
        [
          {
            "node": "Fupper",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Send message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge6": {
      "main": [
        [
          {
            "node": "Cria Histórico Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If5": {
      "main": [
        [
          {
            "node": "Adiciona CHAT supabase1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Atualiza CHAT Supabase1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Busca Telefone1": {
      "main": [
        [
          {
            "node": "If5",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Adiciona CHAT supabase1": {
      "main": [
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Atualiza CHAT Supabase1": {
      "main": [
        [
          {
            "node": "Merge6",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Cria Histórico Supabase1": {
      "main": [
        [
          {
            "node": "Delete Memory1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split de Mensagem1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "1 segundo1": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split de mensagens1": {
      "main": [
        [
          {
            "node": "Split de Mensagem1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Split1": {
      "ai_languageModel": [
        [
          {
            "node": "Split de mensagens1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Modelo Output1": {
      "ai_outputParser": [
        [
          {
            "node": "Split de mensagens1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Merge7": {
      "main": [
        [
          {
            "node": "Busca Telefone1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create new notes1": {
      "main": [
        [
          {
            "node": "Split de mensagens1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send message1": {
      "main": [
        [
          {
            "node": "1 segundo1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model6": {
      "ai_languageModel": [
        [
          {
            "node": "Modelo Output1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Fupper": {
      "main": [
        [
          {
            "node": "Merge7",
            "type": "main",
            "index": 0
          },
          {
            "node": "Create new notes1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code2": {
      "main": [
        [
          {
            "node": "Fupper",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Think2": {
      "ai_tool": [
        [
          {
            "node": "Fupper",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "precos": {
      "ai_tool": [
        [
          {
            "node": "Fupper",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "informacoes": {
      "ai_tool": [
        [
          {
            "node": "Fupper",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "precos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory3": {
      "ai_memory": [
        [
          {
            "node": "precos",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model7": {
      "ai_languageModel": [
        [
          {
            "node": "informacoes",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Postgres Chat Memory6": {
      "ai_memory": [
        [
          {
            "node": "informacoes",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Calculator1": {
      "ai_tool": [
        [
          {
            "node": "precos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calculator2": {
      "ai_tool": [
        [
          {
            "node": "informacoes",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "perder_lead": {
      "ai_tool": [
        [
          {
            "node": "Fupper",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store": {
      "ai_vectorStore": [
        [
          {
            "node": "buscar_documentos",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "buscar_documentos": {
      "ai_tool": [
        [
          {
            "node": "precos",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI Vector": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store2": {
      "ai_vectorStore": [
        [
          {
            "node": "buscar_informacoes",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Docs1": {
      "ai_languageModel": [
        [
          {
            "node": "buscar_informacoes",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI Vector1": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store2",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "buscar_informacoes": {
      "ai_tool": [
        [
          {
            "node": "informacoes",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Docs": {
      "ai_languageModel": [
        [
          {
            "node": "buscar_documentos",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store5": {
      "ai_vectorStore": [
        [
          {
            "node": "buscar_documentos3",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "buscar_documentos3": {
      "ai_tool": [
        [
          {
            "node": "agente preços",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Docs4": {
      "ai_languageModel": [
        [
          {
            "node": "buscar_documentos3",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI Vector4": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store5",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Supabase Vector Store3": {
      "ai_vectorStore": [
        [
          {
            "node": "buscar_documentos1",
            "type": "ai_vectorStore",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Docs2": {
      "ai_languageModel": [
        [
          {
            "node": "buscar_documentos1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI Vector2": {
      "ai_embedding": [
        [
          {
            "node": "Supabase Vector Store3",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "buscar_documentos1": {
      "ai_tool": [
        [
          {
            "node": "receptivo informacoes",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "receptivo informacoes": {
      "ai_tool": [
        [
          {
            "node": "orquestrador",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model4": {
      "ai_languageModel": [
        [
          {
            "node": "Modelo Output",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Modelo Output": {
      "ai_outputParser": [
        [
          {
            "node": "Split de mensagens",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "Atualizar Cliente": {
      "main": [
        [
          {
            "node": "ROTA Mensagens",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "errorWorkflow": "dCpCqA316QocWWea",
    "timezone": "America/Sao_Paulo"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Webhook EVO": [
      {
        "json": {
          "headers": {
            "host": "n8n-new-n8n.ca31ey.easypanel.host",
            "user-agent": "axios/1.12.2",
            "content-length": "799",
            "accept": "application/json, text/plain, */*",
            "accept-encoding": "gzip, compress, deflate, br",
            "content-type": "application/json",
            "x-forwarded-for": "172.18.0.1",
            "x-forwarded-host": "n8n-new-n8n.ca31ey.easypanel.host",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "e73584281a1d",
            "x-real-ip": "172.18.0.1"
          },
          "params": {},
          "query": {},
          "body": {
            "event": "messages.upsert",
            "instance": "comercial_cruzeiro",
            "data": {
              "key": {
                "id": "wamid.HBgNNTUxMTk0NTcyMjExNxUCABIYFDNBRjIyRkUwMEIzNTM2Mzk1MDBCAA==",
                "remoteJid": "5511945722117@s.whatsapp.net",
                "fromMe": false
              },
              "pushName": "Luan",
              "message": {
                "conversation": "Oi"
              },
              "messageType": "conversation",
              "messageTimestamp": 1762876607,
              "source": "unknown",
              "instanceId": "d8bb7bbd-90b9-443f-b41d-aebffb21477a"
            },
            "destination": "https://n8n-new-n8n.ca31ey.easypanel.host/webhook/comercial_cruzeiro",
            "date_time": "2025-11-11T12:56:48.484Z",
            "server_url": "https://outros-evolution-api.ca31ey.easypanel.host",
            "apikey": "EAAVtQLT2wukBPZBxZC9yxTZCTvbCbQZCasYZAdzEBLAgHrBPQX2PaxfR7uKMIr3ZBAbEW4RPlIYNs1ZCZCeU2YACBt3PVseU8rwm81U0P0I1Wy2RXJGFB4ZAppTTeBvmutFz8QPgPMltxZBElNFdL5hWACFzZBlZBE1OjlPDwS7EZA5ZCGb7tysIRcPQJIfAtxVAFieYtvPgZDZD"
          },
          "webhookUrl": "https://n8n-new-n8n.ca31ey.easypanel.host/webhook/comercial_cruzeiro",
          "executionMode": "production"
        }
      }
    ]
  },
  "versionId": "0408ed48-d7ed-4f9a-a8d5-716f85e08607",
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2025-07-25T20:01:53.090Z",
      "createdAt": "2025-07-25T20:01:53.090Z",
      "role": "workflow:owner",
      "workflowId": "afID0dTfsm0vtXUX",
      "projectId": "TjZRFTZS7ptjaNGj"
    }
  ],
  "tags": [
    {
      "updatedAt": "2025-07-30T20:41:48.074Z",
      "createdAt": "2025-07-30T20:41:48.074Z",
      "id": "HCAYGF54Hj7mAMlF",
      "name": "ai"
    }
  ]
}